<!DOCTYPE html><html><head><title></title><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" href="codebase/all.min.css" type="text/css" media="screen" charset="utf-8"><script src="codebase/all.min.js"></script><script src="codebase/google/markerclusterer.min.js"></script><style>.toolbar_title{padding:10px 10px;line-height:10px;background:#3498db;color:#fff;text-align: center;}.webix_table_checkbox{width:22px;height:22px;margin-top:5px;}.controls {background-color: #fff;border-radius: 2px;border: 1px solid transparent;box-sizing: border-box;font-family: Roboto;font-size: 15px;font-weight: 300;height: 29px;margin-left: 17px;margin-top: 10px;outline: none;padding: 0 11px 0 13px;text-overflow: ellipsis;width: 400px;}.controls:focus {border-color: #4d90fe;}.mapLabel {padding:0px 0px;line-height:10px;background:#3498db;color:#fff;text-align: center;}</style></head><body><script>var _getRootUrl="http://localhost:83/aatmr", _imageCurrentUser="HUZuG1480336944.jpg", _nameCurrentUser="Apichat Peekoa", _header_menuByRole=[{id:"f1",value: "1. ",open: 1,data:[{id: "createPickupSheet",value: "1.1 Create PUS",icon: "minus",details: ""},{id: "editPus",value: "1.2 Edit PUS",icon: "minus",details: ""},{id: "cancelPus",value: "1.3 Cancel PUS",icon: "minus",details: ""}]},{id:"f2",value: "2. ",open: 1,data:[{id: "uploadOrder",value: "2.1 Upload Order",icon: "minus",details: ""},{id: "viewOrder",value: "2.2 View Order",icon: "minus",details: ""},{id: "view204",value: "2.3 View 204",icon: "minus",details: ""},{id: "truckMonitor",value: "2.4 Truck Monitor",icon: "minus",details: ""},{id: "transaction",value: "2.8 Transaction",icon: "minus",details: ""},{id: "tMap",value: "2.9 Map",icon: "minus",details: ""}]},{id:"f3",value: "3. Master Data",open: 1,data:[{id: "truckMaster",value: "3.1 Truck Master",icon: "minus",details: ""},{id: "driverMaster",value: "3.2 Driver Master",icon: "minus",details: ""},{id: "routeCover",value: "3.3 Route TTV Master",icon: "minus",details: ""},{id: "partMaster",value: "3.4 Part Master",icon: "minus",details: ""},{id: "dockMaster",value: "3.5 Dock Master",icon: "minus",details: ""},{id: "supplierMaster",value: "3.6 Supplier Master",icon: "minus",details: ""}]},{id:"spt",value: "68. Support Team",open: 1,data:[{id: "role",value: "68.1 Role Master",icon: "minus",details: ""},{id: "userRole",value: "68.2 Change Role",icon: "minus",details: ""},{id: "add_user",value: "68.3 Add User",icon: "minus",details: ""}]},{id:"admin",value: "69. Admin",open: 1,data:[{id: "addMenu",value: "69.1 Add Menu",icon: "minus",details: ""}]}];var header_menuObj={history:"header_history",profileUser:"header_profileUser",homePage:"header_homePage",404:"header_404",changepass:"header_changepass","addMenu":"header_addMenu","role":"header_role","userRole":"header_userRole","add_user":"header_add_user","createPickupSheet":"header_createPickupSheet","truckMaster":"header_truckMaster","driverMaster":"header_driverMaster","routeCover":"header_routeCover","partMaster":"header_partMaster","dockMaster":"header_dockMaster","supplierMaster":"header_supplierMaster","uploadOrder":"header_uploadOrder","viewOrder":"header_viewOrder","view204":"header_view204","truckMonitor":"header_truckMonitor","tMap":"header_tMap","cancelPus":"header_cancelPus","editPus":"header_editPus","transaction":"header_transaction"};var header_homePage=function(){return{id:"header_homePage",cols:[{id:"homePage",view:"iframe",src:"home.htm"}]}};var header_404=function(){return{view:"scrollview",scroll:"native-y",id:"header_404",body:{id:"404_id",type:"clean",rows:[{},{view:"label",height:420,label:"<center><img class=\'photo\' src=\'images/404.png\' width=\'700\' height=\'420\' /></center>"},{}],on:{onHide:function(){},onShow:function(){},onAddView:function(){}}}}};var header_changepass=function(){return{paddingX:5,paddingY:5,rows:[{paddingY:1,cols:[{view:"form",id:'changepass_form',elements:[{view:"text",type:'password',label:'Old Password (รหัสเก่า)',labelPosition:"top",id:"changepass_pass1",name:"pass1"},{view:"text",type:'password',label:'New Password (รหัสใหม่)',labelPosition:"top",id:"changepass_pass2",name:"pass2"},{view:"text",type:'password',label:'New Password (รหัสใหม่)',labelPosition:"top",id:"changepass_pass3",name:"pass3"},{cols:[{view:"button",value:"OK (ตกลง)",type:"form",on:{onItemClick:function(id,e){var btn=this;webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){btn.disable();var obj=$$('changepass_form').getValues();obj.pass1=sha1(obj.pass1);$.post("profile/changePass_update.php",{obj:obj,type:1}).done(function(data){btn.enable();var data=eval('('+data+')');if(data.ch==1){$$('changepass_form').setValues({pass1:'',pass2:'',pass3:''});webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}})}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}}}]}],rules:{$obj:function(data){if(data.pass1==''||data.pass2==''||data.pass3==''){webix.message({type:"error",expire:7000,text:"กรุณากรอกข้อมูลให้ครบ",align:"center"});return !1}else if(data.pass3!=data.pass2){webix.message({type:"error",expire:7000,text:"คุณกรอก Password ไม่เหมื่อนกัน"});return !1}else return !0}}},{},{}]}]}};var header_profileUser=function(){return{view:"scrollview",scroll:"native-y",id:'header_profileUser',body:{id:"header_id",type:"clean",rows:[{cols:[{view:"form",id:'profileUser_form',elements:[{rows:[{view:"datatable",id:"profileUser_T1",columns:[{id:"data1",header:"Image (รูป)",template:function(obj){if(obj.data1)return "<img src='"+obj.data1+"' style='cursor:pointer; width:80px; height:100px;'>";return ""},width:100},{id:"data2",header:"First Name (ชื่อ)",width:200},{id:"data3",header:"Last Name (สกุล)",width:200}],autoheight:!0,autowidth:!0,rowHeight:80,on:{onItemClick:function(id){if(id.column=="data1")$$("profileUser_upload").fileDialog({rowid:id.row})}}}]}]},{},{}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){$.post("profile/profileUser_data.php",{type:1}).done(function(data){var data=eval('('+data+')');if(data.ch==1){var dataT1=$$('profileUser_T1');dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({id:"profileUser_upload",view:"uploader",name:"uploader",multiple:!1,autosend:!0,upload:"profile/profileUser_uploadImage.php",on:{onBeforeFileAdd:function(item){var type=item.type.toLowerCase();if(type!="jpg"&&type!="png"){webix.message("Only PNG or JPG images are supported");return !1}},onFileUpload:function(item){},onFileUploadError:function(item){webix.alert("Error during file upload")},onUploadComplete:function(data){var dataT1=$$('profileUser_T1'),image;dataT1.clearAll();dataT1.parse(data.sname,"jsarray");$$('person_template').parse({id:data.sname[0][1].split('/')[2],name:data.sname[0][4]})}},apiOnly:!0})}}}}};var header_addMenu=function(){return{view:"scrollview",scroll:"native-y",id:'header_addMenu',body:{id:"addMenu_id",type:"clean",rows:[{view:"form",paddingY:0,id:"addMenu_form1",elements:[{cols:[{view:"text",id:"addMenu_group",name:"menu_group",label:"Group",labelPosition:"top"},{view:"combo",id:"addMenu_header",name:"menu_header",label:"Header",labelPosition:"top",value:0,options:['0','1']},{view:"text",id:"addMenu_id",name:"menu_menuId",label:"Menu Id",labelPosition:"top"},{view:"text",id:"addMenu_name",name:"menu_menuName",label:"Menu Name",labelPosition:"top"},{view:"text",id:"addMenu_use",name:"menu_menuUse",label:"Menu Use",labelPosition:"top"},{view:"text",id:"addMenu_url",name:"menu_menuUrl",label:"Menu Url",labelPosition:"top"},{view:"combo",id:"addMenu_for",name:"menu_for",label:"Menu For",labelPosition:"top",value:"ALL",options:['ALL','ADMIN','SUPPORT']}]},{cols:[{view:"button",value:"Save (บันทึกข้อมูล)",type:"form",id:"addMenu_save",width:160,on:{onItemClick:function(id,e){if($$('addMenu_form1').validate()){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){var dataT1=$$('addMenu_dataT1'),objAr=[];var btn=$$('addMenu_save');btn.disable();$.post("admin/addMenu_insert.php",{obj:$$('addMenu_form1').getValues(),type:1}).done(function(data){btn.enable();var data=eval('('+data+')');if(data.ch==1){window.location.reload()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});console.log($$('addMenu_form1').getValues())}}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Clear (ล้างข้อมูล)",type:"danger",width:150,id:"addMenu_clear",on:{onItemClick:function(id,e){$$('menu_group').setValue('');$$('menu_header').setValue('1');$$('menu_menuId').setValue('');$$('menu_menuName').setValue('');$$('menu_menuUse').setValue('');$$('menu_for').setValue('ALL')}}},{},{},{},{}]}],rules:{menu_group:webix.rules.isNotEmpty,menu_header:webix.rules.isNotEmpty,menu_menuId:webix.rules.isNotEmpty,menu_menuName:webix.rules.isNotEmpty,menu_menuUse:webix.rules.isNotEmpty,menu_for:webix.rules.isNotEmpty}},{paddingX:20,rows:[{view:"datatable",id:"addMenu_dataT1",navigation:!0,autoheight:!0,resizeColumn:!0,datatype:"jsarray",hover:"myhover",scrollAlignY:!0,columns:[{id:"data0",header:"id",width:50},{id:"data1",header:"menu_group",width:120},{id:"data2",header:"menu_header",width:120},{id:"data3",header:"menu_menuId",width:120},{id:"data4",header:"menu_menuName",width:250},{id:"data5",header:"menu_menuUse",width:120},{id:"data6",header:"menu_at",width:180},{id:"data7",header:"For",width:100}],on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"addMenu_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){$.post("admin/addMenu_getData.php",{type:1}).done(function(data){var dataT1=$$('addMenu_dataT1');data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});dataT1.clearAll()}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}}}};var header_role=function(){return{view:"scrollview",scroll:"native-y",id:'header_role',body:{id:"role_id",type:"clean",rows:[{view:"form",paddingY:0,id:"role_form1",elements:[{cols:[{view:"fieldset",label:"Update Role (แก้ใขบทบาท)",body:{rows:[{view:"combo",id:"role_roleName",name:"role",label:"Role Name",labelPosition:"top",yCount:"10",suggest:"userM/role_getRole.php?type=1",on:{onChange:function(value){$.post("userM/role_getRole.php",{obj:value,type:2}).done(function(data){var dataT1=$$('role_dataT1');data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});dataT1.clearAll()}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{cols:[{view:"button",value:"Save (บันทึกข้อมูล)",type:"form",id:"role_save",on:{onItemClick:function(id,e){if($$('role_dataT1').count()>0){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){var dataT1=$$('role_dataT1'),objAr=[];dataT1.eachRow(function(row){tRow=dataT1.getItem(row);if(tRow.$parent==0){tRow=webix.copy(tRow);tRow.d2=1;tRow.d3=1;tRow.d4=1}delete tRow.$parent;delete tRow.$level;delete tRow.$count;objAr[objAr.length]=tRow});var btn=$$('role_save');btn.disable();$.post("userM/role_update.php",{obj:objAr,type:1}).done(function(data){btn.enable();var data=eval('('+data+')');if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});$$('role_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'<b>ไม่พบข้อมูลในตาราง</b>',callback:function(){}})}}},{view:"button",value:"Clear (ล้างข้อมูล)",type:"danger",id:"role_clear",on:{onItemClick:function(id,e){var dataT1=$$('role_dataT1'),role=$$('role_roleName');dataT1.clearAll();role.blockEvent();role.setValue('');role.unblockEvent();role.getPopup().getBody().load("userM/role_getRole.php?type=1");$$('role_roleName2').setValue('')}}}]},{paddingX:2,rows:[{view:"treetable",id:"role_dataT1",navigation:!0,autoheight:!0,resizeColumn:!0,autowidth:!0,hover:"myhover",threeState:!0,scrollAlignY:!0,columns:[{id:"value",header:"Menu Name",width:250,template:"{common.treetable()} #value#"},{id:"d1",header:"ดู",width:50,template:"{common.checkbox()}",css:"role_checkBox1"},{id:"d2",header:"เพิ่ม",width:50,template:"{common.checkbox()}",css:"role_checkBox1"},{id:"d3",header:"ลบ",width:50,template:"{common.checkbox()}",css:"role_checkBox1"},{id:"d4",header:"แก้ใข",width:80,template:"{common.checkbox()}",css:"role_checkBox1"}],on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"role_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}]}},{view:"fieldset",label:"Add Role (เพิ่มบทบาท)",body:{rows:[{view:"text",id:"role_roleName2",name:"role2",label:"Role Name",labelPosition:"top"},{cols:[{view:"button",value:"Add (เพิ่มบทบาท)",type:"form",id:"role_save2",on:{onItemClick:function(id,e){if($$('role_form1').validate()){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องเพิ่มกฏ<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){var btn=$$('role_save2');btn.disable();$.post("userM/role_insert.php",{obj:$$('role_roleName2').getValue(),type:1}).done(function(data){btn.enable();var data=eval('('+data+')');if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});$$('role_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{}]}]}},{}]},{}],rules:{role2:webix.rules.isNotEmpty}}],on:{onHide:function(){},onShow:function(){setTimeout(function(){$$('role_roleName').focus()},50)},onAddView:function(){$$('role_dataT1').on_click.webix_table_checkbox=function(e,id,trg){var column="d"+trg.parentNode.getAttribute("column"),nextId,isOpen;if(this.getItem(id).$parent!=0){if(column=="d1"){if(this.getItem(this.getItem(id).$parent).d1){if(!this.getItem(id)[column]){this.getItem(id).d1=1;this.getItem(id).d2=1;this.getItem(id).d3=1;this.getItem(id).d4=1}else{this.getItem(id).d1=0;this.getItem(id).d2=0;this.getItem(id).d3=0;this.getItem(id).d4=0}}}else{if(this.getItem(id).d1){if(this.getItem(id)[column])this.getItem(id)[column]=0;else this.getItem(id)[column]=1}}}else if(column=="d1"){if(this.getItem(id)[column])this.getItem(id)[column]=0;else this.getItem(id)[column]=1;this.refresh(id);isOpen=this.getItem(id)[column];nextId=this.getItem(id).id;for(var i=-1,len=this.getItem(id).$count;++i<len;){nextId=this.getNextId(nextId,1);if(isOpen){this.getItem(nextId).d1=1;this.getItem(nextId).d2=1;this.getItem(nextId).d3=1;this.getItem(nextId).d4=1}else{this.getItem(nextId).d1=0;this.getItem(nextId).d2=0;this.getItem(nextId).d3=0;this.getItem(nextId).d4=0}this.refresh(nextId)}}this.refresh(id);return !1}}}}}};var header_userRole=function(){return{view:"scrollview",scroll:"native-y",id:'header_userRole',body:{id:"userRole_id",type:"clean",rows:[{view:"form",paddingY:0,id:"userRole_form1",elements:[{cols:[{view:"fieldset",label:"Update Role (แก้ใขบทบาท)",body:{rows:[{view:"combo",id:"userRole_roleName",width:200,name:"role",label:"Role Name",labelPosition:"top",yCount:"10",suggest:"userM/role_getRole.php?type=1",on:{onChange:function(value){}}},{cols:[{view:"button",value:"Save (บันทึกข้อมูล)",type:"form",id:"userRole_save",on:{onItemClick:function(id,e){var dataT1=$$('userRole_T1'),objArray=dataT1.getSelectedId(!0),len=objArray.length,btn=$$('userRole_save');if(dataT1.count()>0){if(len){if($$('userRole_roleName').getValue()!=''){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการลบข้อมูลที่คุณเลือก<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){btn.disable();var idConcat=[];for(var i=-1;++i<len;){idConcat[idConcat.length]=dataT1.getItem(objArray[i].row).data5}$.post("userM/userRole_update.php",{obj:idConcat.join(','),param:$$('userRole_roleName').getValue(),type:1}).done(function(data){btn.enable();var data=eval('('+data+')');if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาเลือกกฏ',callback:function(){}})}}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาเลือกข้อมูลในตาราง',callback:function(){}})}}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}},{view:"button",value:"Refresh (โหลดใหม่)",id:"userRole_refresh",on:{onItemClick:function(id,e){userRole_loadData()}}},{view:"button",value:"Clear (ล้างข้อมูล)",type:"danger",id:"userRole_clear",on:{onItemClick:function(id,e){var dataT1=$$('userRole_T1'),role=$$('userRole_roleName');dataT1.clearAll();role.blockEvent();role.setValue('');role.unblockEvent();role.getPopup().getBody().load("userM/userRole_getRole.php?type=1")}}}]},{paddingX:2,rows:[{view:"datatable",id:"userRole_T1",columns:[{id:"data1",header:"Image (รูป)",template:function(obj){if(obj.data1)return "<img src='"+obj.data1+"' style='cursor:pointer; width:60px; height:60px;'>";return ""},width:80},{id:"data2",header:"First Name (ชื่อ)",width:200},{id:"data3",header:"Last Name (สกุล)",width:200},{id:"data4",header:"Role",width:200}],autoheight:!0,multiselect:!0,select:"row",autowidth:!0,navigation:!0,resizeColumn:!0,rowHeight:60,hover:"myhover",datatype:"jsarray"}]}]}},{}]},{}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){window.userRole_loadData=function(){$.post("userM/userRole_data.php",{type:1}).done(function(data){var data=eval('('+data+')');if(data.ch==1){var dataT1=$$('userRole_T1');dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})};userRole_loadData()}}}}};var header_add_user=function(){return{view:"scrollview",scroll:"native-y",id:'header_add_user',body:{id:"add_user_id",type:"line",rows:[{type:"line",cols:[{rows:[{view:"form",paddingY:0,id:"add_user_form1",elements:[{cols:[{rows:[{cols:[{view:"text",id:"add_user_userName",name:"userName",label:"User Name (ชื่อเข้าใช้งาน)",labelPosition:"top",width:180},{view:"text",id:"add_user_fName",name:"fName",label:"First Name (ชื่อ)",labelPosition:"top"},{view:"text",id:"add_user_lName",name:"lName",label:"Last Name (สกุล)",labelPosition:"top"},{view:"combo",id:"add_user_roleName",width:200,name:"role",label:"Role Name",labelPosition:"top",yCount:"10",suggest:"userM/role_getRole.php?type=1",on:{onChange:function(value){}}}]},{cols:[{view:"button",value:"Save (บันทึกข้อมูล)",type:"form",id:"add_user_save",on:{onItemClick:function(id,e){if($$('add_user_form1').validate()){var btn=this;webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){btn.disable();$.post("userM/addUser_insert.php",{obj:$$('add_user_form1').getValues(),type:1}).done(function(data){btn.enable();var data=eval('('+data+')'),dataT1=$$('add_user_T1');if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data,"jsarray");$$('add_user_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){$$('cancel_grn_grn').focus()}})}}},{view:"button",value:"Refresh (โหลดใหม่)",id:"add_user_refresh",on:{onItemClick:function(id,e){add_user_loadData()}}},{view:"button",value:"Clear (ล้างข้อมูล)",type:"danger",id:"add_user_clear",on:{onItemClick:function(id,e){var dataT1=$$('add_user_T1'),role=$$('add_user_roleName');role.blockEvent();role.setValue('');role.unblockEvent();$$('add_user_userName').setValue('');$$('add_user_fName').setValue('');$$('add_user_lName').setValue('');role.getPopup().getBody().load("userM/add_user_getRole.php?type=1");$$('add_user_roleName2').setValue('')}}}]},{paddingX:2,rows:[{view:"datatable",id:"add_user_T1",scheme:{$change:function(item){if(parseInt(item.data7)==0)item.$css="my_disabled"}},columns:[{id:"data0",header:"#",width:50},{id:"data1",header:"Image (รูป)",template:function(obj){if(obj.data1)return "<img src='"+obj.data1+"' style='cursor:pointer; width:60px; height:60px;'>";return ""},width:80},{id:"data2",header:"User Name",width:150},{id:"data3",header:["First Name (ชื่อ)",{content:"textFilter"}],width:200},{id:"data4",header:["Last Name (สกุล)",{content:"textFilter"}],width:200},{id:"data5",header:["Role",{content:"textFilter"}],width:200},{id:"data8",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"data9",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-key'></span>"}],autoheight:!0,multiselect:!0,select:"row",autowidth:!0,navigation:!0,resizeColumn:!0,rowHeight:60,hover:"myhover",datatype:"jsarray",onClick:{"fa-pencil":function(e,t){$$('add_user_win_edituser').show();$$('add_user_win_form1').setValues($$('add_user_T1').getItem(t))},"fa-key":function(e,t){var userID=$$('add_user_T1').getItem(t).data6;webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการ <b>Reset Password</b><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post("userM/addUser_update.php",{obj:{data6:userID},type:3}).done(function(ddd){var dataT1=$$("add_user_T1"),data=eval('('+ddd+')');if(data.ch==1){webix.message({type:"default",expire:7000,text:'บันทึกสำเร็จ'});dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}}}]}]},{}]},{}],rules:{userName:webix.rules.isNotEmpty,fName:webix.rules.isNotEmpty,lName:webix.rules.isNotEmpty,role:webix.rules.isNotEmpty}}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){window.add_user_loadData=function(){$.post("userM/addUser_data.php",{type:1}).done(function(data){var data=eval('('+data+')');if(data.ch==1){var dataT1=$$('add_user_T1');dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})};add_user_loadData();webix.ui({view:"window",id:"add_user_win_edituser",modal:1,head:"Edit User (แก้ใขข้อมูล)",top:50,position:"center",body:{view:"form",scroll:!1,id:"add_user_win_form1",width:700,elements:[{cols:[{rows:[{view:"text",id:"add_user_fName_e",name:"data3",label:"First Name (ชื่อ)",labelPosition:"top"},{view:"text",id:"add_user_lName_e",name:"data4",label:"Last Name (สกุล)",labelPosition:"top"},{view:"text",labelAlign:"right",label:'id',id:"add_user_id_e",name:"data6",value:"",hidden:1},{view:"checkbox",label:"Active",id:"add_user_active_e",name:"data7"}]}]},{cols:[{},{view:"button",value:"OK",type:"form",width:150,click:function(){if($$('add_user_win_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post("userM/addUser_update.php",{obj:$$('add_user_win_form1').getValues(),type:2}).done(function(ddd){var dataT1=$$("add_user_T1"),data=eval('('+ddd+')');if(data.ch==1){$$('add_user_clear_e').callEvent("onItemClick",[]);webix.message({type:"default",expire:7000,text:'บันทึกสำเร็จ'});dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel",type:"danger",id:"add_user_clear_e",width:150,on:{onItemClick:function(id){$$('add_user_win_edituser').hide();$$('add_user_fName_e').setValue('');$$('add_user_lName_e').setValue('')}}}]}],rules:{}}})}}}}};var header_createPickupSheet=function(){var fd='f1/createPickupSheet_data.php',objData={},calBox1={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},calBox2={PTB:0,CPB:0,STP:0,PTP:0,PPB:0};function normalState(){$$('createPickupSheet_date').enable();$$('createPickupSheet_routeTrip').enable();$$('createPickupSheet_supplierCode').enable();$$('createPickupSheet_ttvIn').disable();$$('createPickupSheet_ttvOut').disable();$$('createPickupSheet_truckLicense').disable();$$('createPickupSheet_truckType').disable();$$('createPickupSheet_driverName').disable();$$('createPickupSheet_phone').disable();$$('createPickupSheet_remark').disable();$$('createPickupSheet_col2').show();$$('createPickupSheet_save').hide();$$('createPickupSheet_calcel').hide();$$('createPickupSheet_showData').hide();$$('createPickupSheet_showhide').hide()};function workingState(){$$('createPickupSheet_date').disable();$$('createPickupSheet_routeTrip').disable();$$('createPickupSheet_supplierCode').disable();$$('createPickupSheet_ttvIn').enable();$$('createPickupSheet_ttvOut').enable();$$('createPickupSheet_truckLicense').enable();$$('createPickupSheet_truckType').enable();$$('createPickupSheet_driverName').enable();$$('createPickupSheet_phone').enable();$$('createPickupSheet_remark').enable();$$('createPickupSheet_col2').hide();$$('createPickupSheet_save').show();$$('createPickupSheet_calcel').show();$$('createPickupSheet_showData').show();$$('createPickupSheet_showhide').show();$$('createPickupSheet_form1').show();$$('createPickupSheet_form1').clearValidation();$($$('createPickupSheet_doctype').$view).removeClass('webix_invalid')};function init(){var doctype=$$('createPickupSheet_doctype'),list=doctype.getPopup().getList();doctype.blockEvent();list.clearAll();doctype.setValue('');webix.ajax().post(fd,{type:1},function(text,data){var data=eval('('+text+')'),htmlNode=$(doctype.$view);list.parse(data);doctype.unblockEvent();if(data.length>0){doctype.enable();if(!htmlNode.hasClass('webix_invalid'))htmlNode.addClass('webix_invalid');webix.message({type:"error",expire:7000,text:'คุณมีงานค้างโปรดตรวจสอบ'})}else{doctype.disable();if(htmlNode.hasClass('webix_invalid'))htmlNode.removeClass('webix_invalid')}})};function rendertable1(){var dataT1=$$('createPickupSheet_dataT1');var boxCal={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},row;dataT1.eachRow(function(row){row=dataT1.getItem(row);boxCal[row.boxType]+=parseInt(row.box)});$$('createPickupSheet_PTB1').getInputNode().textContent=boxCal.PTB;$$('createPickupSheet_CPB1').getInputNode().textContent=boxCal.CPB;$$('createPickupSheet_STP1').getInputNode().textContent=boxCal.STP;$$('createPickupSheet_PTP1').getInputNode().textContent=boxCal.PTP;$$('createPickupSheet_PPB1').getInputNode().textContent=boxCal.PPB};function initParams(){var params={};if(window.location.search){var parts=location.search.substring(1).split('&');for(var i=0;i<parts.length;i++){var nv=parts[i].split('=');if(!nv[0])continue;params[nv[0]]=nv[1]||!0}}if($$('createPickupSheet_date').isEnabled()){if('route' in params&&'supplierCode' in params&&'date' in params){$$('createPickupSheet_date').setValue(params.date);$$('createPickupSheet_routeTrip').setValue(params.route);$$('createPickupSheet_supplierCode').setValue(params.supplierCode)}}};return{view:"scrollview",scroll:"native-y",id:"header_createPickupSheet",body:{id:"createPickupSheet_id",type:"clean",rows:[{view:"form",paddingY:0,id:"createPickupSheet_form1",elements:[{cols:[{view:"combo",id:"createPickupSheet_printName",name:"printName",label:"Printer Name (ปริ้นเตอร์)",labelPosition:"top",value:"",yCount:"10",options:"php/getPrinter.php",on:{onChange:function(value){localStorage.setItem("_createPickupSheet_printName",value)},onAfterRender:function(value){var v=localStorage.getItem("_createPickupSheet_printName")||'NO_PRINT';this.blockEvent();this.setValue(v);this.unblockEvent()}}},{view:"counter",label:"Copies",value:"1",id:"createPickupSheet_copies",labelPosition:"top",hidden:!0},{view:"combo",yCount:"10",suggest:fd+"?type=1",label:'Document No (งานค้าง)',id:"createPickupSheet_doctype",name:"doctype",value:"",labelPosition:"top",on:{onChange:function(value){if(value.length>0)this.disable();else this.enable();$.post(fd,{doc:value,type:12}).done(function(data){data=JSON.parse(data);if(data.ch==1){var form=$$('createPickupSheet_form1').getValues(),header=data.header;form.date=header.date;form.routeTrip=header.routeTrip;form.supplierCode=header.supplierCode;form.ttvIn=header.ttvIn||'00:00';form.ttvOut=header.ttvOut||'00:00';form.truckLicense=header.truckLicense;form.truckType=header.truckType;form.driverName=header.driverName;form.phone=header.phone;form.remark=header.remark;objData.refID=header.refID;$$('createPickupSheet_form1').setValues(form);comboSet('createPickupSheet_truckLicense',header.truckLicense);comboSet('createPickupSheet_driverName',header.driverName);var dataT1=$$('createPickupSheet_dataT2');dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('createPickupSheet_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1()}workingState()})}}},{view:"datepicker",align:"left",label:'Date[y-m-d] (วันที่)',labelPosition:"top",value:new Date(),id:"createPickupSheet_date",name:"date",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",required:!0,label:'Route (เส้นทาง)',id:"createPickupSheet_routeTrip",name:"routeTrip",labelPosition:"top"},{view:"text",required:!0,label:'Supplier Code',id:"createPickupSheet_supplierCode",name:"supplierCode",labelPosition:"top"}]},{cols:[{view:"text",required:!0,label:'เวลาออก TTV',id:"createPickupSheet_ttvOut",name:"ttvOut",labelPosition:"top",type:'time'},{view:"text",required:!0,label:'เวลากลับ TTV',id:"createPickupSheet_ttvIn",name:"ttvIn",labelPosition:"top",type:'time'},{view:"combo",required:!0,label:'Truck License (ทะเบียนรถ)',id:"createPickupSheet_truckLicense",name:"truckLicense",labelPosition:"top",suggest:"f3/truckMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/truckMaster_data.php",{obj:{truckLicense:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('createPickupSheet_truckType').setValue(data[0])})}}},{view:"text",required:!0,label:'Truck Type (ชนิดรถ)',id:"createPickupSheet_truckType",name:"truckType",labelPosition:"top"},{view:"combo",required:!0,label:'Driver Name (ชื่อคนขับรถ)',id:"createPickupSheet_driverName",name:"driverName",labelPosition:"top",suggest:"f3/driverMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/driverMaster_data.php",{obj:{driverName:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('createPickupSheet_phone').setValue(data[0])})}}}]},{cols:[{view:"text",required:!0,label:'Phone (เบอร์โทรศัทพ์)',id:"createPickupSheet_phone",name:"phone",labelPosition:"top"},{view:"text",required:!1,label:'Remark (หมายเหตุ)',id:"createPickupSheet_remark",name:"remark",labelPosition:"top"},{},{},{}]}],rules:{ttvIn:function(v){return v!='00:00'},ttvOut:function(v){return v!='00:00'}},on:{"onSubmit":function(view,e){if(view.config.name=='remark'){}else if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}},{id:"createPickupSheet_col2",cols:[{},{},{view:"button",icon:"users",value:"OK(ตกลง)",id:"createPickupSheet_btnOK",on:{onItemClick:function(id,e){if($$('createPickupSheet_date').validate()&&$$('createPickupSheet_routeTrip').validate()&&$$('createPickupSheet_supplierCode').validate()){var btn=this;btn.disable();$.post(fd,{obj:$$('createPickupSheet_form1').getValues(),type:11}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){var form=$$('createPickupSheet_form1').getValues(),header=data.header;form.date=header.date;form.routeTrip=header.routeTrip;form.supplierCode=header.supplierCode;form.ttvIn=header.ttvIn||'00:00';form.ttvOut=header.ttvOut||'00:00';form.truckLicense=header.truckLicense;form.truckType=header.truckType;form.driverName=header.driverName;form.phone=header.phone;form.remark=header.remark;form.doctype=header.doctype;objData.refID=header.refID;$$('createPickupSheet_form1').setValues(form);comboSet('createPickupSheet_truckLicense',header.truckLicense);comboSet('createPickupSheet_driverName',header.driverName);var dataT1=$$('createPickupSheet_dataT2');dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('createPickupSheet_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1();workingState();var doctype=$$('createPickupSheet_doctype'),list=doctype.getPopup().getList();doctype.blockEvent();list.clearAll();list.parse([header.doctype]);doctype.setValue(list.getFirstId());doctype.unblockEvent()}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}})}else{webix.message({type:"error",expire:7000,text:'กรุณาป้อนข้อมูล'})}}}},{},{}]},{cols:[{},{view:"button",icon:"users",value:"Show/Hide",id:"createPickupSheet_showhide",on:{onItemClick:function(id,e){if($$('createPickupSheet_form1').isVisible()){$$('createPickupSheet_form1').hide()}else $$('createPickupSheet_form1').show()}}},{view:"button",value:"Save (บันทึก)",id:"createPickupSheet_save",type:"form",click:function(e){var btn=this,dataT1=$$('createPickupSheet_dataT1'),dataT2=$$('createPickupSheet_dataT2');if(dataT1.count()>0&&dataT2.count()==0&&$$("createPickupSheet_form1").validate()){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>บันทึกข้อมูล</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){btn.disable();$.post(fd,{obj:$$('createPickupSheet_form1').getValues(),type:41}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});$$('createPickupSheet_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง<br>หรือกรอกข้อมูลไม่ครบ',callback:function(){}})}}},{view:"button",type:"danger",value:"Cancel (ยกเลิกเอกสาร)",hidden:0,id:"createPickupSheet_calcel",on:{onItemClick:function(id,e){var btn=this;webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>ยกเลิกเอกสาร</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){btn.disable();$.post(fd,{obj:$$('createPickupSheet_form1').getValues(),type:31}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.message({type:"default",expire:7000,text:data.data});$$('createPickupSheet_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}}},{},{view:"button",value:"Clear (ล้างหน้าจอ)",hidden:1,id:"createPickupSheet_clear",on:{onItemClick:function(id,e){if(!$$('createPickupSheet_form1').isVisible())$$('createPickupSheet_form1').show();normalState();$$('createPickupSheet_form1').clearValidation();init();$$('createPickupSheet_date').setValue(new Date());$$('createPickupSheet_routeTrip').setValue('');$$('createPickupSheet_supplierCode').setValue('');$$('createPickupSheet_ttvIn').setValue('');$$('createPickupSheet_ttvOut').setValue('');$$('createPickupSheet_truckLicense').setValue('');$$('createPickupSheet_truckType').setValue('');$$('createPickupSheet_driverName').setValue('');$$('createPickupSheet_phone').setValue('');$$('createPickupSheet_remark').setValue('');$$("createPickupSheet_dataT1").clearAll();$$("createPickupSheet_dataT2").clearAll();$$('createPickupSheet_supplierCode').focus()}}}]},{id:"createPickupSheet_showData",cols:[{paddingX:5,rows:[{height:25,cols:[{},{},{view:"label",label:"PTB",align:"center"},{view:"label",label:"CPB",align:"center"},{view:"label",label:"STP",align:"center"},{view:"label",label:"PTP",align:"center"},{view:"label",label:"PPB",align:"center"},{},{}]},{cols:[{},{},{view:"button",id:"createPickupSheet_PTB1",label:"0",name:'tooltip',value:'กล่องพลาสติก'},{view:"button",id:"createPickupSheet_CPB1",label:"0",name:'tooltip',value:'กล่องลูกฟูก'},{view:"button",id:"createPickupSheet_STP1",label:"0",name:'tooltip',value:'แร็ค'},{view:"button",id:"createPickupSheet_PTP1",label:"0",name:'tooltip',value:'พาเลทพลาสติก'},{view:"button",id:"createPickupSheet_PPB1",label:"0",name:'tooltip',value:'กล่องกระดาษ'},{},{view:"button",type:"danger",type:"iconButtonTop",icon:"angle-double-right",on:{"onAfterRender":function(e){this.$view.getElementsByTagName("button")[0].className=this.$view.getElementsByTagName("button")[0].className.replace('webixtype_base','webixtype_danger')},"onItemClick":function(id,e){var dataT1=$$('createPickupSheet_dataT1'),btn=this;if(dataT1.count()>0){dataT1.selectRange(dataT1.getFirstId(),dataT1.getLastId());var objArray=dataT1.getSelectedId(!0),len=objArray.length;var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}btn.disable();$.post(fd,{obj:{form:$$('createPickupSheet_form1').getValues(),orderID:orderID.join(',')},type:14}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.selected);dataT1=$$('createPickupSheet_dataT2');dataT1.clearAll();dataT1.parse(data.order);rendertable1()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}}]},{paddingY:0,height:35,view:"toolbar",cols:[{view:"label",label:"Truck Simulate",align:"center"}]},{view:"datatable",id:"createPickupSheet_dataT1",multiselect:!0,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,hover:"myhover",navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"NO_PGM",header:"NO_PGM",width:80},{id:"partNo",header:"Part No",width:225},{id:"box",header:"Box",width:120,footer:{content:"summColumn",colspan:1}},{id:"boxType",header:"Box Type",width:200}],on:{}}]},{paddingX:5,rows:[{height:25,cols:[{},{},{view:"label",label:"PTB",align:"center"},{view:"label",label:"CPB",align:"center"},{view:"label",label:"STP",align:"center"},{view:"label",label:"PTP",align:"center"},{view:"label",label:"PPB",align:"center"},{},{}]},{cols:[{view:"button",type:"iconButtonTop",icon:"angle-double-left",on:{"onAfterRender":function(e){this.$view.getElementsByTagName("button")[0].className=this.$view.getElementsByTagName("button")[0].className.replace('webixtype_base','webixtype_form')},"onItemClick":function(id,e){var dataT1=$$('createPickupSheet_dataT2'),btn=this;if(dataT1.count()>0){dataT1.selectRange(dataT1.getFirstId(),dataT1.getLastId());var objArray=dataT1.getSelectedId(!0),len=objArray.length;var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}btn.disable();$.post(fd,{obj:{form:$$('createPickupSheet_form1').getValues(),orderID:orderID.join(',')},type:13}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('createPickupSheet_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}},{},{view:"button",id:"createPickupSheet_PTB2",label:"0",name:'tooltip',value:'กล่องพลาสติก'},{view:"button",id:"createPickupSheet_CPB2",label:"0",name:'tooltip',value:'กล่องลูกฟูก'},{view:"button",id:"createPickupSheet_STP2",label:"0",name:'tooltip',value:'แร็ค'},{view:"button",id:"createPickupSheet_PTP2",label:"0",name:'tooltip',value:'พาเลทพลาสติก'},{view:"button",id:"createPickupSheet_PPB2",label:"0",name:'tooltip',value:'กล่องกระดาษ'},{},{}]},{paddingY:0,height:35,view:"toolbar",cols:[{view:"label",label:"Order",align:"center"}]},{view:"datatable",id:"createPickupSheet_dataT2",multiselect:!0,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,hover:"myhover",navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"NO_PGM",header:"NO_PGM",width:80},{id:"partNo",header:"Part No",width:225},{id:"box",header:"Box",width:120,footer:{content:"summColumn",colspan:1}},{id:"boxType",header:"Box Type",width:200}],on:{"onSelectChange":function(){var dataAr=this.getSelectedId(!0),len=dataAr.length;var boxCal={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},row;for(var i=0;i<len;i++){row=this.getItem(dataAr[i].row);boxCal[row.boxType]+=parseInt(row.box)}$$('createPickupSheet_PTB2').getInputNode().textContent=boxCal.PTB;$$('createPickupSheet_CPB2').getInputNode().textContent=boxCal.CPB;$$('createPickupSheet_STP2').getInputNode().textContent=boxCal.STP;$$('createPickupSheet_PTP2').getInputNode().textContent=boxCal.PTP;$$('createPickupSheet_PPB2').getInputNode().textContent=boxCal.PPB}}}]}]}],on:{onHide:function(){},onShow:function(){initParams()},onAddView:function(){webix.ui({view:"tooltip",template:"#tooltip#"});init();normalState();initParams()}}}}};var header_truckMaster=function(){var fd='f3/truckMaster_data.php';return{view:"scrollview",scroll:"native-y",id:"header_truckMaster",body:{id:"truckMaster_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:180,label:"Add New (เพิ่มรถ)",id:"truckMaster_save",on:{onItemClick:function(id,e){$$('truckMaster_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"truckMaster_ok",on:{onItemClick:function(id,e){var dataT1=$$("truckMaster_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','truckLicense','truckType','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No","Truck License","Truck Type","Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{}]},{paddingX:2,rows:[{view:"datatable",id:"truckMaster_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"truckMaster_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"No",css:"rank",width:50},{id:"truckLicense",header:["Truck License",{content:"textFilter"}],editor:"text",width:150},{id:"truckType",header:["Truck Type",{content:"textFilter"}],width:120,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('truckMaster_edit').show();var row=this.getItem(t),obj;$$('truckMaster_edit_form1').setValues(row)},"fa-file-text-o":function(e,t){$$('truckMaster_log').show();var dataT1=$$("truckMaster_dataT3");$.post("masterdata/truckMaster_data.php",{type:2,id:this.getItem(t).ID}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"truckMaster_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("truckMaster_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"truckMaster_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"truckMaster_edit_form1",width:600,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMaster_edit_id",name:"ID",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMaster_edit_license",name:"truckLicense",label:"Truck License (ทะเบียนรถ)",value:""}]},{cols:[{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMaster_edit_type",name:"truckType",label:"Truck Type (ชนิดรถ)",value:"4W",options:['4W','6W','10W']}]},{cols:[{view:"checkbox",labelPosition:"top",labelWidth:120,id:"truckMaster_edit_status",name:"status",label:"Active",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"truckMaster_edit_ok",width:150,click:function(){if($$('truckMaster_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('truckMaster_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("truckMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('truckMaster_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"truckMaster_edit_clear",width:150,on:{onItemClick:function(id){$$('truckMaster_edit').hide()}}}]}],rules:{truckLicense:webix.rules.isNotEmpty,truckType:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"truckMaster_new",head:"Add New (เพิ่มรถ)",top:100,position:"center",body:{view:"form",scroll:!1,id:"truckMaster_new_form1",width:600,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMaster_new_license",name:"truckLicense",label:"Truck License (ทะเบียนรถ)",value:""}]},{cols:[{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMaster_new_type",name:"truckType",label:"Truck Type (ชนิดรถ)",value:"4W",options:['4W','6W','10W']},{}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"truckMaster_new_ok",width:150,click:function(){if($$('truckMaster_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('truckMaster_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("truckMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('truckMaster_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"truckMaster_new_clear",width:150,on:{onItemClick:function(id){$$('truckMaster_new').hide();$$('truckMaster_new_license').setValue('');$$('truckMaster_new_type').setValue('')}}}]}],rules:{truckLicense:webix.rules.isNotEmpty,truckType:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"truckMaster_log",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"ประวัติการแก้ใข"},{},{view:"icon",icon:"times-circle",click:"$$('truckMaster_log').hide();$$('truckMaster_dataT3').clearAll();"}]},top:50,position:"center",width:1100,height:400,body:{view:"scrollview",body:{rows:[{view:"datatable",id:"truckMaster_dataT3",navigation:!0,autoheight:!0,resizeColumn:!0,hover:"myhover",datatype:"json",columns:[{id:"data0",header:"No",css:"rank",width:50},{id:"data1",header:["Details"],editor:"text",width:730},{id:"data2",header:["Create Date"],width:150},{id:"data3",header:["Create By"],width:150}]}]}}})}}}}};var header_driverMaster=function(){var fd='f3/driverMaster_data.php';return{view:"scrollview",scroll:"native-y",id:"header_driverMaster",body:{id:"driverMaster_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:200,label:"Add New (เพิ่มคนขับรถ)",id:"driverMaster_save",on:{onItemClick:function(id,e){$$('driverMaster_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"driverMaster_ok",on:{onItemClick:function(id,e){var dataT1=$$("driverMaster_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','fNameTH','lNameTH','phone','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No","First Name","Last Name","Phone","Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{}]},{paddingX:2,rows:[{view:"datatable",id:"driverMaster_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"driverMaster_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"NO",css:"rank",width:50},{id:"fNameTH",header:["First Name",{content:"textFilter"}],editor:"text",width:150},{id:"lNameTH",header:["Last Name",{content:"textFilter"}],editor:"text",width:220},{id:"phone",header:["Phone",{content:"textFilter"}],width:120,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('driverMaster_edit').show();var row=this.getItem(t),obj;$$('driverMaster_edit_form1').setValues(row)},"fa-file-text-o":function(e,t){$$('driverMaster_log').show();var dataT1=$$("driverMaster_dataT3");$.post(fd,{type:3,id:this.getItem(t).data7}).done(function(data){var data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"driverMaster_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("driverMaster_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"driverMaster_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"driverMaster_edit_form1",width:600,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_edit_id",name:"id",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_edit_fName",name:"fNameTH",label:"First Name (ชื่อ)",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_edit_lName",name:"lNameTH",label:"Last Name (นามสกุล)",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_edit_phone",name:"phone",label:"Phone (เบอร์โทร)",value:""}]},{cols:[{view:"checkbox",labelPosition:"top",labelWidth:120,id:"driverMaster_edit_status",name:"status",label:"Active",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"driverMaster_edit_ok",width:150,click:function(){if($$('driverMaster_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('driverMaster_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("driverMaster_dataT1"),data=eval('('+ddd+')');if(data.ch==1){$$('driverMaster_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"driverMaster_edit_clear",width:150,on:{onItemClick:function(id){$$('driverMaster_edit').hide()}}}]}],rules:{fNameTH:webix.rules.isNotEmpty,lNameTH:webix.rules.isNotEmpty,phone:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"driverMaster_new",head:"Add New (เพิ่มคนขับรถ)",top:100,position:"center",body:{view:"form",scroll:!1,id:"driverMaster_new_form1",width:600,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_new_fName",name:"fNameTH",label:"First Name (ชื่อ)",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_new_lName",name:"lNameTH",label:"Last Name (นามสกุล)",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"driverMaster_new_phone",name:"phone",label:"Phone (เบอร์โทร)",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"driverMaster_new_ok",width:150,click:function(){if($$('driverMaster_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('driverMaster_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("driverMaster_dataT1"),data=eval('('+ddd+')');if(data.ch==1){$$('driverMaster_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"driverMaster_new_clear",width:150,on:{onItemClick:function(id){$$('driverMaster_new').hide();$$('driverMaster_new_fName').setValue('');$$('driverMaster_new_lName').setValue('');$$('driverMaster_new_phone').setValue('')}}}]}],rules:{fNameTH:webix.rules.isNotEmpty,lNameTH:webix.rules.isNotEmpty,phone:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}})}}}}};var header_routeCover=function(){var fd='f3/routeCover_data.php';return{view:"scrollview",scroll:"native-y",id:"header_routeCover",body:{id:"routeCover_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:200,label:"Add New (เพิ่มเส้นทาง)",id:"routeCover_save",on:{onItemClick:function(id,e){$$('routeCover_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"routeCover_ok",on:{onItemClick:function(id,e){var dataT1=$$("routeCover_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','routeTrip','tripTTV','truckLicense','truckType','driverName','phone','planTimeOut','planTimeIn','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No",'Route','Route TTV','Truck License','Truck Type','Driver Name','Phone','เวลาออก TTV','เวลากลับ TTV',"Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{}]},{paddingX:2,rows:[{view:"datatable",id:"routeCover_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"routeCover_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"NO",css:"rank",width:50},{id:"routeTrip",header:["Route",{content:"textFilter"}],width:150,editor:"combo"},{id:"tripTTV",header:["Route TTV",{content:"textFilter"}],editor:"text",width:150},{id:"truckLicense",header:["Truck License",{content:"textFilter"}],editor:"text",width:150},{id:"truckType",header:["Truck Type",{content:"textFilter"}],editor:"text",width:150},{id:"driverName",header:["Driver Name",{content:"textFilter"}],width:120,editor:"combo"},{id:"phone",header:["Phone",{content:"textFilter"}],width:120,editor:"combo"},{id:"planTimeOut",header:["เวลาออก TTV",{content:"textFilter"}],width:120,editor:"combo"},{id:"planTimeIn",header:["เวลากลับ TTV",{content:"textFilter"}],width:120,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('routeCover_edit').show();var row=this.getItem(t),obj;$$('routeCover_edit_form1').setValues(row);comboSet('routeCover_edit_truckLicense',row.truckLicense);comboSet('routeCover_edit_driverName',row.driverName)},"fa-file-text-o":function(e,t){$$('routeCover_log').show();var dataT1=$$("routeCover_dataT3");$.post(fd,{type:3,id:this.getItem(t).data7}).done(function(data){var data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"routeCover_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("routeCover_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"routeCover_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"routeCover_edit_form1",width:600,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_id",name:"id",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_routeTrip",name:"routeTrip",label:"Route",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_tripTTV",name:"tripTTV",label:"Route TTV",value:""}]},{cols:[{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_truckLicense",name:"truckLicense",label:"Truck License",value:"",suggest:"f3/truckMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/truckMaster_data.php",{obj:{truckLicense:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('routeCover_edit_truckType').setValue(data[0])})}}},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_truckType",name:"truckType",label:"Truck Type",value:"4W",options:['4W','6W','10W']},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_driverName",name:"driverName",label:"Driver Name",suggest:"f3/driverMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/driverMaster_data.php",{obj:{driverName:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('routeCover_edit_phone').setValue(data[0])})}}}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_phone",name:"phone",label:"Phone (เบอร์โทร)",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_planTimeOut",name:"planTimeOut",label:"เวลาออก TTV",value:"00:00",type:'time'},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_edit_planTimeIn",name:"planTimeIn",label:"เวลากลับ TTV",value:"00:00",type:'time'}]},{cols:[{view:"checkbox",labelPosition:"top",labelWidth:120,id:"routeCover_edit_status",name:"status",label:"Active",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"routeCover_edit_ok",width:150,click:function(){if($$('routeCover_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('routeCover_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("routeCover_dataT1"),data=eval('('+ddd+')');if(data.ch==1){$$('routeCover_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"routeCover_edit_clear",width:150,on:{onItemClick:function(id){$$('routeCover_edit').hide()}}}]}],rules:{routeTrip:webix.rules.isNotEmpty,tripTTV:webix.rules.isNotEmpty,truckLicense:webix.rules.isNotEmpty,truckType:webix.rules.isNotEmpty,driverName:webix.rules.isNotEmpty,phone:webix.rules.isNotEmpty,planTimeOut:webix.rules.isNotEmpty,planTimeIn:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"routeCover_new",head:"Add New (เพิ่มเส้นทาง)",top:100,position:"center",body:{view:"form",scroll:!1,id:"routeCover_new_form1",width:600,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_routeTrip",name:"routeTrip",label:"Route",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_tripTTV",name:"tripTTV",label:"Route TTV",value:""}]},{cols:[{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_truckLicense",name:"truckLicense",label:"Truck License",value:"",suggest:"f3/truckMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/truckMaster_data.php",{obj:{truckLicense:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('routeCover_new_truckType').setValue(data[0])})}}},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_truckType",name:"truckType",label:"Truck Type",value:"4W",options:['4W','6W','10W']},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_driverName",name:"driverName",label:"Driver Name",suggest:"f3/driverMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/driverMaster_data.php",{obj:{driverName:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('routeCover_new_phone').setValue(data[0])})}}}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_phone",name:"phone",label:"Phone (เบอร์โทร)",value:""},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_planTimeOut",name:"planTimeOut",label:"เวลาออก TTV",value:"00:00",type:'time'},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"routeCover_new_planTimeIn",name:"planTimeIn",label:"เวลากลับ TTV",value:"00:00",type:'time'}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"routeCover_new_ok",width:150,click:function(){if($$('routeCover_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('routeCover_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("routeCover_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('routeCover_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"routeCover_new_clear",width:150,on:{onItemClick:function(id){$$('routeCover_new').hide();$$('routeCover_new_form1').setValues({routeTrip:'',tripTTV:'',truckLicense:'',truckType:'4W',driverName:'',phone:'',planTimeOut:'00:00',planTimeIn:'00:00'})}}}]}],rules:{routeTrip:webix.rules.isNotEmpty,tripTTV:webix.rules.isNotEmpty,truckLicense:webix.rules.isNotEmpty,truckType:webix.rules.isNotEmpty,driverName:webix.rules.isNotEmpty,phone:webix.rules.isNotEmpty,planTimeOut:webix.rules.isNotEmpty,planTimeIn:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"routeCover_log",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"ประวัติการแก้ใข"},{},{view:"icon",icon:"times-circle",click:"$$('routeCover_log').hide();$$('routeCover_dataT3').clearAll();"}]},top:50,position:"center",width:1100,height:400,body:{view:"scrollview",body:{rows:[{view:"datatable",id:"routeCover_dataT3",navigation:!0,autoheight:!0,resizeColumn:!0,hover:"myhover",datatype:"jsarray",columns:[{id:"data0",header:"No",css:"rank",width:50},{id:"data1",header:["Details"],editor:"text",width:730},{id:"data2",header:["Create Date"],width:150},{id:"data3",header:["Create By"],width:150}]}]}}})}}}}};var header_partMaster=function(){var fd='f3/partMaster_data.php';return{view:"scrollview",scroll:"native-y",id:"header_partMaster",body:{id:"partMaster_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:200,label:"Add New (รหัสสินค้า)",id:"partMaster_save",on:{onItemClick:function(id,e){$$('partMaster_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"partMaster_ok",on:{onItemClick:function(id,e){var dataT1=$$("partMaster_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','partNo','partName','snpIn','snpOut','qty_per_box','box_per_pallet','boxType','box_w','box_l','box_h','palletType','pallet_w','pallet_l','pallet_h','weight','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No",'Part No','Part Name','SNP IN','SNP OUT','Qty Per Box','Box Per Pallet','Box Type','Box w','Box l','Box h','Pallet Type','Pallet w','Pallet l','Pallet h','Weight',"Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{}]},{paddingX:2,rows:[{view:"datatable",id:"partMaster_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"partMaster_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"NO",css:"rank",width:50},{id:"partNo",header:["Part No",{content:"textFilter"}],width:200,editor:"combo"},{id:"partName",header:["Part Name",{content:"textFilter"}],width:150,editor:"combo"},{id:"boxType",header:["Box Type",{content:"textFilter"}],width:150,editor:"combo"},{id:"box_w",header:["Box w",{content:"textFilter"}],width:120,editor:"combo"},{id:"box_l",header:["Box l",{content:"textFilter"}],width:120,editor:"combo"},{id:"box_h",header:["Box h",{content:"textFilter"}],width:120,editor:"combo"},{id:"weight",header:["Weight",{content:"textFilter"}],width:120,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('partMaster_edit').show();var row=this.getItem(t),obj;$$('partMaster_edit_form1').setValues(row);comboSet('partMaster_edit_truckLicense',row.truckLicense);comboSet('partMaster_edit_driverName',row.driverName)},"fa-file-text-o":function(e,t){$$('partMaster_log').show();var dataT1=$$("partMaster_dataT3");$.post(fd,{type:3,id:this.getItem(t).data7}).done(function(data){var data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"jsarray")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"partMaster_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("partMaster_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"partMaster_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"partMaster_edit_form1",width:800,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"partMaster_edit_id",name:"id",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"partMaster_edit_partNo",name:"partNo",label:"Part No",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_edit_partName",name:"partName",label:"Part Name",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_snpIn",name:"snpIn",label:"SNP IN",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_snpOut",name:"snpOut",label:"SNP OUT",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_qty_per_box",name:"qty_per_box",label:"Qty Per Box",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_box_per_pallet",name:"box_per_pallet",label:"Box Per Pallet",value:""},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"partMaster_edit_boxType",name:"boxType",label:"Box Type",value:"",options:['CORRUGATE BOX','CARDBOARD BOX','PLASTIC BOX','PLASTIC PALLET','WOODEN PALLET','PLASTIC BAG','STEEL PALLET','STEEL RACK']},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_edit_box_w",name:"box_w",label:"Box w",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_edit_box_l",name:"box_l",label:"Box l",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_edit_box_h",name:"box_h",label:"Box h",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_palletType",name:"palletType",label:"Pallet Type",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_pallet_w",name:"pallet_w",label:"Pallet w",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_pallet_l",name:"pallet_l",label:"Pallet l",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_edit_pallet_h",name:"pallet_h",label:"Pallet h",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_edit_weight",name:"weight",label:"Weight",value:""},{}]},{cols:[{view:"checkbox",labelPosition:"top",labelWidth:120,id:"partMaster_edit_status",name:"status",label:"Active",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"partMaster_edit_ok",width:150,click:function(){if($$('partMaster_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('partMaster_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("partMaster_dataT1"),data=eval('('+ddd+')');if(data.ch==1){$$('partMaster_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"partMaster_edit_clear",width:150,on:{onItemClick:function(id){$$('partMaster_edit').hide();$$("partMaster_edit_form1").setValues('')}}}]}],rules:{partNo:webix.rules.isNotEmpty,boxType:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"partMaster_new",head:"Add New (รหัสสินค้า)",top:100,position:"center",body:{view:"form",scroll:!1,id:"partMaster_new_form1",width:800,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"partMaster_new_partNo",name:"partNo",label:"Part No",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_new_partName",name:"partName",label:"Part Name",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_snpIn",name:"snpIn",label:"SNP IN",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_snpOut",name:"snpOut",label:"SNP OUT",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_qty_per_box",name:"qty_per_box",label:"Qty Per Box",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_box_per_pallet",name:"box_per_pallet",label:"Box Per Pallet",value:""},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"partMaster_new_boxType",name:"boxType",label:"Box Type",value:"",options:['CORRUGATE BOX','CARDBOARD BOX','PLASTIC BOX','PLASTIC PALLET','WOODEN PALLET','PLASTIC BAG','STEEL PALLET','STEEL RACK']},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_new_box_w",name:"box_w",label:"Box w",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_new_box_l",name:"box_l",label:"Box l",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_new_box_h",name:"box_h",label:"Box h",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_palletType",name:"palletType",label:"Pallet Type",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_pallet_w",name:"pallet_w",label:"Pallet w",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_pallet_l",name:"pallet_l",label:"Pallet l",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,disabled:!0,id:"partMaster_new_pallet_h",name:"pallet_h",label:"Pallet h",value:""},{view:"text",labelPosition:"top",required:!1,labelWidth:120,id:"partMaster_new_weight",name:"weight",label:"Weight",value:""},{}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"partMaster_new_ok",width:150,click:function(){if($$('partMaster_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('partMaster_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("partMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('partMaster_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"partMaster_new_clear",width:150,on:{onItemClick:function(id){$$('partMaster_new').hide();$$("partMaster_new_form1").setValues('')}}}]}],rules:{partNo:webix.rules.isNotEmpty,boxType:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"partMaster_log",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"ประวัติการแก้ใข"},{},{view:"icon",icon:"times-circle",click:"$$('partMaster_log').hide();$$('partMaster_dataT3').clearAll();"}]},top:50,position:"center",width:1100,height:400,body:{view:"scrollview",body:{rows:[{view:"datatable",id:"partMaster_dataT3",navigation:!0,autoheight:!0,resizeColumn:!0,hover:"myhover",datatype:"jsarray",columns:[{id:"data0",header:"No",css:"rank",width:50},{id:"data1",header:["Details"],editor:"text",width:730},{id:"data2",header:["Create Date"],width:150},{id:"data3",header:["Create By"],width:150}]}]}}})}}}}};var header_dockMaster=function(){var fd='f3/dockMaster_data.php';return{view:"scrollview",scroll:"native-y",id:"header_dockMaster",body:{id:"dockMaster_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:180,label:"Add New (จุดลงงาน)",id:"dockMaster_save",on:{onItemClick:function(id,e){$$('dockMaster_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"dockMaster_ok",on:{onItemClick:function(id,e){var dataT1=$$("dockMaster_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','dock','dockGroup','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No","Dock","Dock Group","Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{}]},{paddingX:2,rows:[{view:"datatable",id:"dockMaster_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"dockMaster_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"No",css:"rank",width:50},{id:"dock",header:["Dock",{content:"textFilter"}],editor:"text",width:150},{id:"dockGroup",header:["Dock Group",{content:"textFilter"}],width:120,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('dockMaster_edit').show();var row=this.getItem(t),obj;$$('dockMaster_edit_form1').setValues(row)},"fa-file-text-o":function(e,t){$$('dockMaster_log').show();var dataT1=$$("dockMaster_dataT3");$.post("masterdata/dockMaster_data.php",{type:2,id:this.getItem(t).ID}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"dockMaster_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("dockMaster_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"dockMaster_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"dockMaster_edit_form1",width:600,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"dockMaster_edit_id",name:"ID",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"dockMaster_edit_dock",name:"dock",label:"Dock",value:""},{}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"dockMaster_edit_dockGroup",name:"dockGroup",label:"Dock Group",value:""},{}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"dockMaster_edit_ok",width:150,click:function(){if($$('dockMaster_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('dockMaster_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("dockMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('dockMaster_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"dockMaster_edit_clear",width:150,on:{onItemClick:function(id){$$('dockMaster_edit').hide()}}}]}],rules:{dock:webix.rules.isNotEmpty,dockGroup:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"dockMaster_new",head:"Add New (จุดลงงาน)",top:100,position:"center",body:{view:"form",scroll:!1,id:"dockMaster_new_form1",width:400,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"dockMaster_new_dock",name:"dock",label:"Dock",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"dockMaster_new_dockGroup",name:"dockGroup",label:"Dock Group",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"dockMaster_new_ok",width:150,click:function(){if($$('dockMaster_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('dockMaster_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("dockMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('dockMaster_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"dockMaster_new_clear",width:150,on:{onItemClick:function(id){$$('dockMaster_new').hide();$$('dockMaster_new_dock').setValue('');$$('dockMaster_new_dockGroup').setValue('')}}}]}],rules:{dock:webix.rules.isNotEmpty,dockGroup:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"dockMaster_log",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"ประวัติการแก้ใข"},{},{view:"icon",icon:"times-circle",click:"$$('dockMaster_log').hide();$$('dockMaster_dataT3').clearAll();"}]},top:50,position:"center",width:1100,height:400,body:{view:"scrollview",body:{rows:[{view:"datatable",id:"dockMaster_dataT3",navigation:!0,autoheight:!0,resizeColumn:!0,hover:"myhover",datatype:"json",columns:[{id:"data0",header:"No",css:"rank",width:50},{id:"data1",header:["Details"],editor:"text",width:730},{id:"data2",header:["Create Date"],width:150},{id:"data3",header:["Create By"],width:150}]}]}}})}}}}};var header_supplierMaster=function(){var fd='f3/supplierMaster_data.php';var map=null,markerAr=[],circleAr=[],last_zoom=10;var mapStyle=[{"elementType":"geometry","stylers":[{"color":"#ebe3cd"}]},{"elementType":"labels.text.fill","stylers":[{"color":"#523735"}]},{"elementType":"labels.text.stroke","stylers":[{"color":"#f5f1e6"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#c9b2a6"}]},{"featureType":"administrative.land_parcel","elementType":"geometry.stroke","stylers":[{"color":"#dcd2be"}]},{"featureType":"administrative.land_parcel","elementType":"labels.text.fill","stylers":[{"color":"#ae9e90"}]},{"featureType":"landscape.natural","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"poi","elementType":"labels.text.fill","stylers":[{"color":"#93817c"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#a5b076"}]},{"featureType":"poi.park","elementType":"labels.text.fill","stylers":[{"color":"#447530"}]},{"featureType":"road","elementType":"geometry","stylers":[{"color":"#f5f1e6"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#fdfcf8"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#f8c967"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#e9bc62"}]},{"featureType":"road.highway.controlled_access","elementType":"geometry","stylers":[{"color":"#e98d58"}]},{"featureType":"road.highway.controlled_access","elementType":"geometry.stroke","stylers":[{"color":"#db8555"}]},{"featureType":"road.local","elementType":"labels.text.fill","stylers":[{"color":"#806b63"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"transit.line","elementType":"labels.text.fill","stylers":[{"color":"#8f7d77"}]},{"featureType":"transit.line","elementType":"labels.text.stroke","stylers":[{"color":"#ebe3cd"}]},{"featureType":"transit.station","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#b9d3c2"}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"color":"#92998d"}]}];var initMap=function(){if(!map){map=new google.maps.Map(document.getElementById('supplierMaster_gMap'),{center:{lat:13.081380260668897,lng:100.91751337051392},zoom:10,mapTypeId:'satellite',fullscreenControl:!1,fullscreenControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT},streetViewControl:!1,zoomControl:!1,mapTypeControl:!1,mapTypeId:google.maps.MapTypeId.HYBRID,styles:mapStyle});var drawingManager=new google.maps.drawing.DrawingManager({drawingMode:null,drawingControl:!0,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:['polygon']},polygonOptions:{strokeColor:'#3498db',fillColor:'#3498db',fillOpacity:.2,strokeWeight:3,clickable:!1,editable:!1,zIndex:1}});drawingManager.setMap(map);google.maps.event.addListener(drawingManager,'polygoncomplete',function(polygon){var paths=polygon.getPath();var polyAr=[];for(var i=0;i<paths.length;i++){var xy=paths.getAt(i);polyAr.push(xy.lat()+' '+xy.lng())}polyAr.push(polyAr[0]);polygon.setMap(null);$$('supplierMaster_winMap').show();$$('supplierMaster_map_form1').setValues({data:'POLYGON(('+polyAr.join(',')+'))'})});google.maps.event.addListener(map,'zoom_changed',function(){});var input=document.getElementById('pac-input');var autocomplete=new google.maps.places.Autocomplete(input);autocomplete.bindTo('bounds',map);map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);var infowindow=new google.maps.InfoWindow();autocomplete.addListener('place_changed',function(){infowindow.close();var place=autocomplete.getPlace();if(!place.geometry){return}if(place.geometry.viewport){map.fitBounds(place.geometry.viewport)}else{map.setCenter(place.geometry.location);map.setZoom(17)}});loadDataMap()}};function loadDataMap(){$.post(fd,{type:5}).done(function(ddd){var data=JSON.parse(ddd);if(data.ch==1){addAllMarker(data.data)}})}function addAllMarker(data){if(map){for(var i=0,len=data.length;i<len;i++){var row=data[i];if(row.geo.type=='Polygon'){var polygonAr=data[i].geo.coordinates[0].map(function(v){return{lat:parseFloat(v[0]),lng:parseFloat(v[1])}});polygonAr.pop();var polygonMap=new google.maps.Polygon({map:map,clickable:!1,paths:polygonAr,strokeColor:'#3498db',fillColor:'#3498db',fillOpacity:.2,strokeWeight:3,clickable:!0,editable:!1});if(row.polyCenter.type=='Point'){var markerImage=new google.maps.MarkerImage('images/factory.png',null,null,null,null);var point={lat:parseFloat(row.polyCenter.coordinates[0]),lng:parseFloat(row.polyCenter.coordinates[1])};var markerMap=new google.maps.Marker({map:map,position:{lat:parseFloat(row.polyCenter.coordinates[0]),lng:parseFloat(row.polyCenter.coordinates[1])},id:row.ID,icon:markerImage});var supName=row.supName,txtCount=supName.length;txtCount+=supName.split(' ').length*.25*-1;txtCount=txtCount*3.5;var markerLabelMap=new MarkerWithLabel({map:map,clickable:!1,position:point,labelContent:supName,labelAnchor:new google.maps.Point(txtCount,50),icon:" ",labelStyle:{border:'none',textAlign:'center',fontSize:'12px',width:'auto',color:'#fff',background:'#3498db'}})}markerAr.push(polygonMap);markerAr.push(markerMap);markerAr.push(markerLabelMap);google.maps.event.addListener(markerMap,'rightclick',(function(marker){return function(){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการลบข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:{ID:marker.id},type:23}).done(function(ddd){var data=JSON.parse(ddd);if(data.ch==1){removeAllMarker();addAllMarker(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}})(markerMap))}}}};function removeAllMarker(){if(map){for(var i=0,len=markerAr.length;i<len;i++){markerAr[i].setMap(null)}markerAr.length=0}};return{view:"scrollview",scroll:"native-y",id:"header_supplierMaster",body:{id:"supplierMaster_id",type:"clean",rows:[{cols:[{},{view:"button",type:"iconButton",icon:"plus",width:180,label:"Add New (ผู้ผลิต)",id:"supplierMaster_save",on:{onItemClick:function(id,e){$$('supplierMaster_new').show()}}},{view:"button",label:"Export Data",type:"iconButton",icon:"file-excel-o",width:180,id:"supplierMaster_ok",on:{onItemClick:function(id,e){var dataT1=$$("supplierMaster_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','code','name','createBy','createDatetime','updateBy','updateDatetime'];data[0]=["No","Supplier Code","Supplier Name","Create By","Create Date","Update By","Update Date"];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}},{view:"button",type:"iconButton",icon:"plus",width:180,label:"show/hide GMAP",id:"",on:{onItemClick:function(id,e){if($$('supplierMaster_map').isVisible()){map=null;$$('supplierMaster_map').hide()}else{$$('supplierMaster_map').show();initMap()}}}},{view:"button",type:"iconButton",icon:"plus",width:180,label:"show/hide Table",id:"",hidden:!0,on:{onItemClick:function(id,e){if($$('supplierMaster_dataT1').isVisible()){$$('supplierMaster_dataT1').hide()}else{$$('supplierMaster_dataT1').show()}}}},{}]},{id:"supplierMaster_map",template:"<input id='pac-input' class='controls' type='text' placeholder='ค้นหาที่อยู่'><div id='supplierMaster_gMap' style='height:600px;'></div>",autoheight:!0,hidden:!0},{paddingX:2,rows:[{view:"datatable",id:"supplierMaster_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",pager:"supplierMaster_pagerA",scheme:{$change:function(item){if(parseInt(item.status)==0)item.$css="my_disabled"}},columns:[{id:"data25",header:"&nbsp;",width:35,template:"<span style='color:#777777;cursor:pointer;' class='webix_icon fa-pencil'></span>"},{id:"NO",header:"No",css:"rank",width:50},{id:"code",header:["Supplier Code",{content:"textFilter"}],editor:"text",width:150},{id:"name",header:["Supplier Name",{content:"textFilter"}],width:350,editor:"combo"},{id:"createBy",header:["Create By"],editor:"text",width:150},{id:"createDatetime",header:["Create Date"],editor:"text",width:150},{id:"updateBy",header:["Update By"],editor:"text",width:150},{id:"updateDatetime",header:["Update Date"],editor:"text",width:150}],onClick:{"fa-pencil":function(e,t){$$('supplierMaster_edit').show();var row=this.getItem(t),obj;$$('supplierMaster_edit_form1').setValues(row)},"fa-file-text-o":function(e,t){$$('supplierMaster_log').show();var dataT1=$$("supplierMaster_dataT3");$.post("masterdata/supplierMaster_data.php",{type:2,id:this.getItem(t).ID}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}},on:{onItemClick:function(id){}}},{type:"wide",cols:[{view:"pager",id:"supplierMaster_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){var dataT1=$$("supplierMaster_dataT1");$.post(fd,{type:1}).done(function(data){var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}});webix.ui({view:"window",move:!0,modal:!0,id:"supplierMaster_edit",head:"Edit (แก้ใข)",top:100,position:"center",body:{view:"form",scroll:!1,id:"supplierMaster_edit_form1",width:600,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_edit_id",name:"ID",label:"Vendor Name",value:"",hidden:1},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_edit_code",name:"code",label:"Supplier Code",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_edit_name",name:"name",label:"Supplier Name",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"supplierMaster_edit_ok",width:150,click:function(){if($$('supplierMaster_edit_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('supplierMaster_edit_form1').getValues(),type:21}).done(function(ddd){var dataT1=$$("supplierMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('supplierMaster_edit_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"supplierMaster_edit_clear",width:150,on:{onItemClick:function(id){$$('supplierMaster_edit').hide()}}}]}],rules:{code:webix.rules.isNotEmpty,name:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"supplierMaster_new",head:"Add New (ผู้ผลิต)",top:100,position:"center",body:{view:"form",scroll:!1,id:"supplierMaster_new_form1",width:400,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_new_code",name:"code",label:"Supplier Code",value:""}]},{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_new_name",name:"name",label:"Supplier Name",value:""}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"supplierMaster_new_ok",width:150,click:function(){if($$('supplierMaster_new_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('supplierMaster_new_form1').getValues(),type:11}).done(function(ddd){var dataT1=$$("supplierMaster_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('supplierMaster_new_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data);dataT1.getPager().render()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"supplierMaster_new_clear",width:150,on:{onItemClick:function(id){$$('supplierMaster_new').hide();$$('supplierMaster_new_form1').setValues('')}}}]}],rules:{code:webix.rules.isNotEmpty,name:webix.rules.isNotEmpty},on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"supplierMaster_winMap",head:{view:"toolbar",cols:[{view:"label",label:"เพิ่มพิกัด",align:"center"}]},top:50,position:"center",body:{view:"form",scroll:!1,id:"supplierMaster_map_form1",width:400,elements:[{cols:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,disabled:!1,id:"supplierMaster_map_lat",name:"data",label:"Polygon",value:""}]},{cols:[{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"supplierMaster_map_code",name:"code",label:"Supplier Code",value:"",suggest:"f3/supplierMaster_data.php?type=3",on:{onChange:function(value,obj){}}}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"supplierMaster_map_ok",width:150,click:function(){if($$('supplierMaster_map_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('supplierMaster_map_form1').getValues(),type:22}).done(function(ddd){var data=JSON.parse(ddd);if(data.ch==1){$$('supplierMaster_map_clear').callEvent("onItemClick",[]);removeAllMarker();addAllMarker(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"supplierMaster_map_clear",width:150,on:{onItemClick:function(id){$$('supplierMaster_winMap').hide();$$('supplierMaster_map_form1').setValues('')}}}]}]}})}}}}};var header_uploadOrder=function(){var fd='f2/uploadOrder_data.php';return{view:"scrollview",scroll:"native-y",id:"header_uploadOrder",body:{id:"uploadOrder_id",type:"clean",rows:[{view:"form",paddingY:0,id:"uploadOrder_form1",elements:[{cols:[{},{view:"button",value:"Upload (อัพโหลด)",id:"uploadOrder_pop_upload",on:{onItemClick:function(id,e){$$('uploadOrder_win_upload').show()}}},{view:"button",value:"Clear",on:{onItemClick:function(id,e){$$('uploadOrder_dataT1').clearAll()}}},{}]}]},{view:"datatable",id:"uploadOrder_dataT1",multiselect:!1,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,hover:"myhover",navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"CD_PLANT",header:"CD_PLANT",width:150},{id:"CD_SUPPLIER_SHP_FR",header:"CD_SUPPLIER_SHP_FR",width:150},{id:"NO_PART_PREFIX",header:"NO_PART_PREFIX",width:150},{id:"NO_PART_BASE",header:"NO_PART_BASE",width:150},{id:"NO_PART_SUFFIX",header:"NO_PART_SUFFIX",width:150},{id:"DT_PGM_START",header:"DT_PGM_START",width:150},{id:"NO_PGM",header:"NO_PGM",width:150},{id:"CD_PICKUP_RTE_NEW",header:"CD_PICKUP_RTE_NEW",width:150},{id:"DT_SHIP",header:"DT_SHIP",width:150},{id:"TM_SHIP",header:"TM_SHIP",width:150},{id:"CD_DELIVRY_RTE_NEW",header:"CD_DELIVRY_RTE_NEW",width:150,sort:"string"},{id:"DT_DELIVERY",header:"DT_DELIVERY",width:150},{id:"TM_DELIVERY",header:"TM_DELIVERY",width:150},{id:"CD_DELIVERY_DOCK",header:"CD_DELIVERY_DOCK",width:150},{id:"QT_SHP_DEL",header:"QT_SHP_DEL",width:150},{id:"QT_CUM_SHP_DEL",header:"QT_CUM_SHP_DEL",width:150},{id:"QT_PKG",header:"QT_PKG",width:150},{id:"WT_PART",header:"WT_PART",width:150},{id:"CD_COUNTRY",header:"CD_COUNTRY",width:150},{id:"NA_COMP",header:"NA_COMP",width:150},{id:"CD_PLANT_DOCK_LOC",header:"CD_PLANT_DOCK_LOC",width:150},{id:"CD_RELEASE_ANAL",header:"CD_RELEASE_ANAL",width:150}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){webix.ui({view:"window",move:!0,modal:!0,id:"uploadOrder_win_upload",top:100,position:"center",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"Upload File"},{},{view:"icon",icon:"times-circle",click:"$$('uploadOrder_win_upload').hide();$$('uploadOrder_upload').files.clearAll();"}]},body:{view:"form",scroll:!1,id:"uploadOrder_win_form1",width:450,elements:[{cols:[{rows:[{view:"uploader",value:'Select File(กดเพื่อเลือกไฟล์)',multiple:!1,autosend:!1,name:"uploader",id:"uploadOrder_upload",link:"uploadOrder_list",upload:fd+"?type=51",on:{onBeforeFileAdd:function(item){var type=item.type.toLowerCase();if(type=="xls"||type=="xlsx"){}else{webix.message("ลองรับเฉพาะ xls,xlsx เท่านั้น");return !1}},onFileUpload:function(item){},onFileUploadError:function(item){webix.alert("Error during file upload")},onUploadComplete:function(data){$$("uploadOrder_upload").files.clearAll();$$('uploadOrder_dataT1').clearAll();$$('uploadOrder_dataT1').parse(data.data,"json");$$('uploadOrder_win_upload').hide()}}},{view:"list",id:"uploadOrder_list",type:"uploader",autoheight:!0,borderless:!0,on:{onAfterRender:function(){if(this.count()>0)$$('uploadOrder_save').show();else $$('uploadOrder_save').hide()}}},{view:"button",label:"Upload (อัพโหลด)",id:"uploadOrder_save",type:'form',hidden:!0,click:function(){var btn=$$('uploadOrder_save');btn.disable();$$("uploadOrder_upload").send(function(response){if(response){btn.enable();webix.message(response.mms)}})}}]}]}]}})}}}}};var header_viewOrder=function(){var fd='f2/viewOrder_data.php';return{view:"scrollview",scroll:"native-y",id:"header_viewOrder",body:{id:"viewOrder_id",type:"clean",rows:[{view:"form",paddingY:0,id:"viewOrder_form1",elements:[{cols:[{view:"datepicker",name:"date1",labelPosition:"top",label:"Start Date (วันเริ่มต้น)",type:"date",id:"viewOrder_date1",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1},{view:"datepicker",name:"date2",labelPosition:"top",label:"End Date (วันสิ้นสุด)",type:"date",id:"viewOrder_date2",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1}]}]},{view:"form",paddingY:0,id:"viewOrder_form2",elements:[{cols:[{view:"button",value:"Find (ค้นหา)",width:130,id:"viewOrder_find",on:{onItemClick:function(id,e){var btn=this,dataT1=$$('viewOrder_dataT1'),obj={};btn.disable();$.post(fd,{obj:$$('viewOrder_form1').getValues(),type:1}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"json")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{},{view:"button",type:"danger",value:"Delete",hidden:0,width:150,id:"viewOrder_del",on:{onItemClick:function(id,e){var dataT1=$$('viewOrder_dataT1'),btn=this;if(dataT1.count()>0){var objArray=dataT1.getSelectedId(!0),len=objArray.length;if(len){var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>ลบข้อมูล</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){btn.disable();$.post(fd,{obj:{form:$$('viewOrder_form1').getValues(),orderID:orderID.join(','),len:len},type:31}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ลบข้อมูลสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data,"json")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาเลือกข้อมูลในตาราง',callback:function(){}})}}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}},{view:"button",value:"Export",width:130,id:"viewOrder_export",on:{onItemClick:function(id,e){var dataT1=$$("viewOrder_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','CD_PLANT','CD_SUPPLIER_SHP_FR','NO_PART_PREFIX','NO_PART_BASE','NO_PART_SUFFIX','DT_PGM_START','NO_PGM','CD_PICKUP_RTE_NEW','DT_SHIP','TM_SHIP','CD_DELIVRY_RTE_NEW','DT_DELIVERY','TM_DELIVERY','CD_DELIVERY_DOCK','QT_SHP_DEL','QT_CUM_SHP_DEL','QT_PKG','WT_PART','CD_COUNTRY','NA_COMP','CD_PLANT_DOCK_LOC','CD_RELEASE_ANAL'];data[0]=['NO','CD_PLANT','CD_SUPPLIER_SHP_FR','NO_PART_PREFIX','NO_PART_BASE','NO_PART_SUFFIX','DT_PGM_START','NO_PGM','CD_PICKUP_RTE_NEW','DT_SHIP','TM_SHIP','CD_DELIVRY_RTE_NEW','DT_DELIVERY','TM_DELIVERY','CD_DELIVERY_DOCK','QT_SHP_DEL','QT_CUM_SHP_DEL','QT_PKG','WT_PART','CD_COUNTRY','NA_COMP','CD_PLANT_DOCK_LOC','CD_RELEASE_ANAL'];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}}]}]},{view:"datatable",id:"viewOrder_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,select:"row",threeState:!0,multiselect:!0,datatype:"json",pager:"viewOrder_Master_pagerA",scheme:{$change:function(item){}},columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"CD_PLANT",header:"CD_PLANT",width:150},{id:"CD_SUPPLIER_SHP_FR",header:"CD_SUPPLIER_SHP_FR",width:150},{id:"NO_PART_PREFIX",header:"NO_PART_PREFIX",width:150},{id:"NO_PART_BASE",header:"NO_PART_BASE",width:150},{id:"NO_PART_SUFFIX",header:"NO_PART_SUFFIX",width:150},{id:"DT_PGM_START",header:"DT_PGM_START",width:150},{id:"NO_PGM",header:"NO_PGM",width:150},{id:"CD_PICKUP_RTE_NEW",header:"CD_PICKUP_RTE_NEW",width:150},{id:"DT_SHIP",header:"DT_SHIP",width:150},{id:"TM_SHIP",header:"TM_SHIP",width:150},{id:"CD_DELIVRY_RTE_NEW",header:"CD_DELIVRY_RTE_NEW",width:150},{id:"DT_DELIVERY",header:"DT_DELIVERY",width:150},{id:"TM_DELIVERY",header:"TM_DELIVERY",width:150},{id:"CD_DELIVERY_DOCK",header:"CD_DELIVERY_DOCK",width:150},{id:"QT_SHP_DEL",header:"QT_SHP_DEL",width:150},{id:"QT_CUM_SHP_DEL",header:"QT_CUM_SHP_DEL",width:150},{id:"QT_PKG",header:"QT_PKG",width:150},{id:"WT_PART",header:"WT_PART",width:150},{id:"CD_COUNTRY",header:"CD_COUNTRY",width:150},{id:"NA_COMP",header:"NA_COMP",width:150},{id:"CD_PLANT_DOCK_LOC",header:"CD_PLANT_DOCK_LOC",width:150},{id:"CD_RELEASE_ANAL",header:"CD_RELEASE_ANAL",width:150}]},{type:"wide",cols:[{view:"pager",id:"viewOrder_Master_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){}}}}};var header_view204=function(){var fd='f2/view204_data.php';function checkDate(date){return date!=null?date.substr(0,5):"-"};return{view:"scrollview",scroll:"native-y",id:"header_view204",body:{id:"view204_id",type:"clean",rows:[{view:"form",paddingY:0,id:"view204_form1",elements:[{cols:[{view:"datepicker",name:"date1",labelPosition:"top",label:"Start Date (วันเริ่มต้น)",type:"date",id:"view204_date1",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1},{view:"datepicker",name:"date2",labelPosition:"top",label:"End Date (วันสิ้นสุด)",type:"date",id:"view204_date2",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1}]}]},{view:"form",paddingY:0,id:"view204_form2",elements:[{cols:[{view:"button",value:"Find (ค้นหา)",width:130,id:"view204_find",on:{onItemClick:function(id,e){var btn=this,dataT1=$$('view204_dataT1'),obj={};btn.disable();$.post(fd,{obj:$$('view204_form1').getValues(),type:1}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"json")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{},{view:"button",value:"Hourly Report",width:130,id:"view204_hour",on:{onItemClick:function(id,e){var btn=this,obj={};btn.disable();$.post(fd,{obj:$$('view204_form1').getValues(),type:2}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){var dataExcel=[];data=data.data;obj['0']=['BOL #','Run Date','Penske Route Number','Penske Tracking Number','Trailer #','Equipment Type'];obj['1']=['Shipper Name #1','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['2']=['Shipper Name #2','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['3']=['Shipper Name #3','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['4']=['Shipper Name #4','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['5']=['Shipper Name #5','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['6']=['Shipper Name #6','Scheduled PA','Scheduled PD','Actual PA','Actual PD','Departure Variance','Standard Loading (minute)','Actual Loading(minute)','Loading Variance'];obj['7']=['Delivery Location #1','Scheduled DA','Scheduled DD','Actual DA','Actual DD','Departure Variance','Standard Offloading (Unloading :DBST)','Actual Offloading (Unloading :DBST)','OffloadingVariance (Unloading Variance)'];obj['8']=['Delivery Location #2','Scheduled DA','Scheduled DD','Actual DA','Actual DD','Departure Variance','Standard Offloading (Unloading :DBST)','Actual Offloading (Unloading :DBST)','OffloadingVariance (Unloading Variance)'];for(var i=0,len=data.length;i<len;i++){var row1=data[i];var ar=[],unload=[],load=[];for(var j=0,len2=row1.length;j<len2;j++){var row=row1[j];if(row.type=='LD'||row.type=='PL'||row.type=='CL'){load.push([row.supplierName,row.time.substr(0,5),row.late.substr(0,5),checkDate(row.acTime),checkDate(row.acOutTime),row.d1,row.d2,row.d3,row.d4].join('|'))}else{unload.push([row.supplierName,row.time.substr(0,5),row.late.substr(0,5),checkDate(row.acTime),checkDate(row.acOutTime),row.d1,row.d2,row.d3,row.d4].join('|'))}}for(var j=0,len2=6-load.length;j<len2;j++){load.push(["-","-","-","-","-","-","-","-","-"].join('|'))}for(var j=0,len2=unload.length;j<len2;j++){load.push(unload[j])}load.unshift([row.bol,row.date,row.route,row.bol.substr(3,10),row.truckLicense,row.truckType].join('|'));dataExcel.push(load.join('|').split('|'))}var col=[],colKey=Object.keys(obj);for(var i=0,len=colKey.length;i<len;i++){col.push(obj[colKey[i]].join('|'))}dataExcel.unshift(col.join('|').split('|'));var worker=new Worker('js/workerToExcelForcs1.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:dataExcel})}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{view:"button",value:"204 Original",width:130,id:"view204_ori",on:{onItemClick:function(id,e){var btn=this,obj={};btn.disable();$.post(fd,{obj:$$('view204_form1').getValues(),type:3}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data.data})}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{view:"button",value:"Export",width:130,id:"view204_export",on:{onItemClick:function(id,e){var dataT1=$$("view204_dataT1"),data=[],btn=$$(this);if(dataT1.count()>0){btn.disable();var f=Object.keys(dataT1.getItem(dataT1.getFirstId())),fName=[];f=['NO','route','supplierCode','supplierName','docDate','docTime','lateDate','lateTime','_supplierCode','_supplierName','_docDate','_docTime','_lateDate','_lateTime','b2'];data[0]=['NO.','Route No.','LD Supplier Code','LD supplier Name','LD Date','LD Time','LD Late Date','LD Late Time','UL Supplier Code','UL Supplier Name','UL Date','UL Time','UL late Date','UL late Time','BOL'];dataT1.eachRow(function(row){var r=dataT1.getItem(row),rr=[];for(var i=-1,len=f.length;++i<len;){rr[rr.length]=r[f[i]]}data[data.length]=rr});var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:"ไม่พบข้อมูลในตาราง",callback:function(){}})}}}}]}]},{view:"datatable",id:"view204_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,pager:"view204_Master_pagerA",datatype:"json",scheme:{$change:function(item){if(item.refID*1>0){item.$css="webix_row_select"}}},columns:[{id:"data22",header:"&nbsp;",width:40,template:"<span style='cursor:pointer' class='webix_icon fa-truck'></span>"},{id:"data23",header:"&nbsp;",width:40,template:function(row){if(row.refID*1>0&&(row.type=='LD'||row.type=='CL')){return "<span style='cursor:pointer' class='webix_icon fa-file-text-o'></span>"}return "<span style='cursor:pointer' class='webix_icon'></span>"}},{id:"NO",header:"NO.",css:"rank",width:50},{id:"route",header:["Route No.",{content:"textFilter"}],width:100},{id:"s5_seq",header:["SEQ",{content:"textFilter"}],width:80},{id:"supplierCode",header:["Supplier Code",{content:"textFilter"}],width:140},{id:"supplierName",header:["supplier Name",{content:"textFilter"}],width:150},{id:"docDate",header:["Date",{content:"textFilter"}],width:120},{id:"docTime",header:["Time",{content:"textFilter"}],width:120},{id:"b2",header:["BOL",{content:"textFilter"}],width:120}],onClick:{"fa-truck":function(e,t){var row=this.getItem(t);if(row.refID*1==0){TTV_changePageWithParams('createPickupSheet',"?route="+row.route+"&supplierCode="+row.supplierCode+"&date="+row.docDate)}else if(row.refID*1>0){$$('view204printPickup_log').show();var obj={};obj.printerName='TEST';obj.copy=1;obj.doctype=row.refID;obj.printType='I';obj.warter='NO';$$("view204printPickup_iframe").load("print/pickupByid.php?printerName="+obj.printerName+"&copy="+obj.copy+"&doctype="+obj.doctype+"&printType="+obj.printType+"&warter="+obj.warter)}},"fa-file-text-o":function(e,t){var row=this.getItem(t);if(row.refID*1>0&&(row.type=='LD'||row.type=='CL')){$$('view204printPickup_log').show();var obj={};obj.printerName='TEST';obj.copy=1;obj.doctype=row.refID;obj.printType='I';obj.warter='NO';$$("view204printPickup_iframe").load("print/ex.php?printerName="+obj.printerName+"&copy="+obj.copy+"&doctype="+obj.doctype+"&printType="+obj.printType+"&warter="+obj.warter)}}}},{type:"wide",cols:[{view:"pager",id:"view204_Master_pagerA",template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},size:10,group:5}]}],on:{onHide:function(){},onShow:function(){if($$('view204_dataT1').count()>0)$$('view204_find').callEvent("onItemClick",[])},onAddView:function(){webix.ui({view:"window",move:!0,modal:!0,id:"view204printPickup_log",head:{view:"toolbar",margin:-4,cols:[{view:"label",label:"ตัวอย่างเอกสาร",height:30},{},{view:"icon",icon:"times-circle",click:"$$('view204printPickup_log').hide();$$('view204printPickup_iframe').load('about:blank');"}]},top:50,position:"center",width:window.innerWidth,height:window.innerHeight,body:{view:"scrollview",body:{rows:[{view:"iframe",id:"view204printPickup_iframe",on:{onAfterLoad:function(){}}}]}}})}}}}};var header_truckMonitor=function(){var fd='f2/truckMonitor_data.php';return{view:"scrollview",scroll:"native-y",id:"header_truckMonitor",body:{id:"truckMonitor_id",type:"clean",rows:[{view:"form",paddingY:0,id:"truckMonitor_form1",elements:[{cols:[{},{view:"button",value:"Reload (โหลดข้อมูลใหม่)",id:"truckMonitor_reload",on:{onItemClick:function(id,e){var btn=this,dataT1=$$('truckMonitor_dataT1'),obj={};btn.disable();$.post(fd,{obj:$$('truckMonitor_form1').getValues(),type:1}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data,"json")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{}]}]},{view:"datatable",id:"truckMonitor_dataT1",navigation:!0,resizeColumn:!0,autoheight:!0,hover:"myhover",threeState:!0,datatype:"json",scheme:{$change:function(item){}},columns:[{id:"data22",header:"&nbsp;",width:40,template:"<span style='cursor:pointer' class='webix_icon fa-clock-o'></span>"},{id:"data23",header:"&nbsp;",width:40,template:"<span style='cursor:pointer' class='webix_icon fa-trash-o'></span>"},{id:"NO",header:"NO.",css:"rank",width:40},{id:"gpsStatus",header:["EDI",{content:"textFilter"}],width:90},{id:"ld_dueDate",header:["วันที่ถึง",{content:"textFilter"}],width:100},{id:"ld_dueTime",header:["เวลาถึง",{content:"textFilter"}],width:70},{id:"ld_acTime",header:["ถึงจริง",{content:"textFilter"}],width:70},{id:"s5_seq",header:["ลำดับ",{content:"textFilter"}],width:55},{id:"routeTrip",header:["รหัสเส้นทาง",{content:"textFilter"}],width:120},{id:"ld_supplierCode",header:["รหัสซัพพลายเออร์",{content:"textFilter"}],width:120},{id:"ld_supplierName",header:["ชื่อซัพพลายเออร์",{content:"textFilter"}],width:150},{id:"truckLicense",header:["ทะเขียนรถ",{content:"textFilter"}],width:120},{id:"driverName",header:["คนขับรถ",{content:"textFilter"}],width:120},{id:"phone",header:["เบอร์โทร",{content:"textFilter"}],width:120},{id:"bol",header:["TRACKING",{content:"textFilter"}],width:120}],onClick:{"fa-clock-o":function(e,t){var row=this.getItem(t),obj={};obj.ID=row._204ld+','+row.tranID+','+row._204ud;obj.date1=row.acDocDate==null?'':row.acDocDate;obj.time1=row.acDocTime==null?'00:00':row.acDocTime;obj.inAG1=row.agType==''?'NS':row.agType;obj.date2=row.acOutDocDate==null?'':row.acOutDocDate;obj.time2=row.acOutDocTime==null?'00:00':row.acOutDocTime;obj.inAG2=row.agTypeOut==''?'NS':row.agTypeOut;obj.edi=row.ediStep;if(row.gpsStatus=='MANAUL'){if(row._204ud*1>0){if(row.type=='PL'){$$('truckMonitor_sup').show();$$('truckMonitor_sup_form1').setValues(obj);if(row.ediStep=='AF')_disable_(['truckMonitor_sup_dateIn','truckMonitor_sup_timeIn','truckMonitor_sup_inAGIn']);else
_enable_(['truckMonitor_sup_dateIn','truckMonitor_sup_timeIn','truckMonitor_sup_inAGIn'])}else{obj.AG=row.forAG==''?'NS':row.forAG;obj.date3='';obj.time3='00:00';$$('truckMonitor_sup2').show();$$('truckMonitor_sup2_form1').setValues(obj);if(row.ediStep=='AF')_disable_(['truckMonitor_sup2_dateIn','truckMonitor_sup2_timeIn','truckMonitor_sup2_inAGIn']);else
_enable_(['truckMonitor_sup2_dateIn','truckMonitor_sup2_timeIn','truckMonitor_sup2_inAGIn'])}}else if(row._204ud*1==0){$$('truckMonitor_aat').show();$$('truckMonitor_aat_form1').setValues(obj);if(row.ediStep=='D1')_disable_(['truckMonitor_aat_dateIn','truckMonitor_aat_timeIn','truckMonitor_aat_inAGIn']);else
_enable_(['truckMonitor_aat_dateIn','truckMonitor_aat_timeIn','truckMonitor_aat_inAGIn'])}}else if(row.gpsStatus=='AUTO')webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ระบบกำลังทำงานอัตโนมัติ',callback:function(){}});else if(row.gpsStatus=='SEND_EDI')webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ระบบกำลังส่งไฟล์ EDI',callback:function(){}});else if(row.gpsStatus=='EDI_ERROR')webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ออก PICKUP SHEET ไม่ครบ',callback:function(){}})},"fa-trash-o":function(e,t){var row=this.getItem(t),obj={};obj.ID=row.tmID;webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการลบข้อมูลที่ทำใน CSR แล้ว<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:obj,type:31}).done(function(ddd){var dataT1=$$("truckMonitor_dataT1"),data=JSON.parse(ddd);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}}}],on:{onHide:function(){},onShow:function(){$$('truckMonitor_reload').callEvent("onItemClick",[])},onAddView:function(){$$('truckMonitor_reload').callEvent("onItemClick",[]);webix.ui({view:"window",move:!0,modal:!0,id:"truckMonitor_sup",head:"เวลาเข้า-ออก Supplier",top:100,position:"center",body:{view:"form",scroll:!1,id:"truckMonitor_sup_form1",width:500,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_id",name:"ID",label:"",value:"",hidden:1},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_edi",name:"edi",label:"",value:"",hidden:1},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_dateIn",name:"date1",label:"วันที่เข้า Supplier",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_timeIn",name:"time1",label:"เวลาที่เข้า Supplier",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_inAGIn",name:"inAG1",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_dateOut",name:"date2",label:"วันที่ออก Supplier",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_timeOut",name:"time2",label:"เวลาที่ออก Supplier",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup_inAGOut",name:"inAG2",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"truckMonitor_sup_ok",width:150,click:function(){if($$('truckMonitor_sup_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('truckMonitor_sup_form1').getValues(),type:41}).done(function(ddd){var dataT1=$$("truckMonitor_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('truckMonitor_sup_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"truckMonitor_sup_clear",width:150,on:{onItemClick:function(id){$$('truckMonitor_sup').hide();$$('truckMonitor_sup_dateIn').setValue('');$$('truckMonitor_sup_timeIn').setValue('00:00');$$('truckMonitor_sup_dateOut').setValue('');$$('truckMonitor_sup_timeOut').setValue('00:00')}}}]}],on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"truckMonitor_sup2",head:"เวลาเข้า-ออก Supplier",top:100,position:"center",body:{view:"form",scroll:!1,id:"truckMonitor_sup2_form1",width:500,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_id",name:"ID",label:"",value:"",hidden:1},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_edi",name:"edi",label:"",value:"",hidden:1},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_dateIn",name:"date1",label:"วันที่เข้า Supplier",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_timeIn",name:"time1",label:"เวลาที่เข้า Supplier",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_inAGIn",name:"inAG1",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_dateOut",name:"date2",label:"วันที่ออก Supplier",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_timeOut",name:"time2",label:"เวลาที่ออก Supplier",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_inAGOut",name:"inAG2",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{},{view:"label",labelPosition:"top",align:"center",labelWidth:120,label:"* ระุบเวลาเข้า AAT *"},{}]},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_dateOutAG",name:"date3",label:"วันที่เข้า AAT",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_timeOutAG",name:"time3",label:"เวลาที่เข้า AAT",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_sup2_AG",name:"AG",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"truckMonitor_sup2_ok",width:150,click:function(){if($$('truckMonitor_sup2_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('truckMonitor_sup2_form1').getValues(),type:42}).done(function(ddd){var dataT1=$$("truckMonitor_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('truckMonitor_sup2_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"truckMonitor_sup2_clear",width:150,on:{onItemClick:function(id){$$('truckMonitor_sup2').hide();$$('truckMonitor_sup2_dateIn').setValue('');$$('truckMonitor_sup2_timeIn').setValue('00:00');$$('truckMonitor_sup2_dateOut').setValue('');$$('truckMonitor_sup2_timeOut').setValue('00:00')}}}]}],on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}});webix.ui({view:"window",move:!0,modal:!0,id:"truckMonitor_aat",head:"เวลาเข้า-ออก AAT",top:100,position:"center",body:{view:"form",scroll:!1,id:"truckMonitor_aat_form1",width:500,elements:[{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_id",name:"ID",label:"",value:"",hidden:1},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_edi",name:"edi",label:"",value:"",hidden:1},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_dateIn",name:"date1",label:"วันที่เข้า AAT",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_timeIn",name:"time1",label:"เวลาที่เข้า AAT",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_inAGIn",name:"inAG1",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{view:"datepicker",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_dateOut",name:"date2",label:"วันที่ออก AAT",value:"",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_timeOut",name:"time2",label:"เวลาที่ออก AAT",type:"time",value:"00:00"},{view:"combo",labelPosition:"top",required:!0,labelWidth:120,id:"truckMonitor_aat_inAGOut",name:"inAG2",label:"สาเหตุที่ล่าช้า",options:['AD','AO','BD','BE','BL','CD','OD','PD','SD','TD','WD','NS'],value:"NS"}]},{cols:[{},{view:"button",value:"OK (ตกลง)",type:"form",id:"truckMonitor_aat_ok",width:150,click:function(){if($$('truckMonitor_aat_form1').validate()){webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการบันทึกข้อมูล<br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){$.post(fd,{obj:$$('truckMonitor_aat_form1').getValues(),type:43}).done(function(ddd){var dataT1=$$("truckMonitor_dataT1"),data=JSON.parse(ddd);if(data.ch==1){$$('truckMonitor_aat_clear').callEvent("onItemClick",[]);webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'บันทึกสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{view:"button",value:"Cancel (ยกเลิก)",type:"danger",id:"truckMonitor_aat_clear",width:150,on:{onItemClick:function(id){$$('truckMonitor_aat').hide();$$('truckMonitor_aat_dateIn').setValue('');$$('truckMonitor_aat_timeIn').setValue('00:00');$$('truckMonitor_aat_dateOut').setValue('');$$('truckMonitor_aat_timeOut').setValue('00:00');$$('truckMonitor_aat_inAGIn').setValue('NS');$$('truckMonitor_aat_inAGOut').setValue('NS')}}}]}],on:{"onSubmit":function(view,e){if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}}})}}}}};var header_tMap=function(){var fd='f2/tMap_data.php';var map=null,map_label=[],markerClusterTruck,markerClusterSuplier,dataTruck=null,markerSuplierAr=[],map_truckAr=[],carInfo=[];var mapStyle=[{"elementType":"geometry","stylers":[{"color":"#ebe3cd"}]},{"elementType":"labels.text.fill","stylers":[{"color":"#523735"}]},{"elementType":"labels.text.stroke","stylers":[{"color":"#f5f1e6"}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#c9b2a6"}]},{"featureType":"administrative.land_parcel","elementType":"geometry.stroke","stylers":[{"color":"#dcd2be"}]},{"featureType":"administrative.land_parcel","elementType":"labels.text.fill","stylers":[{"color":"#ae9e90"}]},{"featureType":"landscape.natural","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"poi","elementType":"labels.text.fill","stylers":[{"color":"#93817c"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#a5b076"}]},{"featureType":"poi.park","elementType":"labels.text.fill","stylers":[{"color":"#447530"}]},{"featureType":"road","elementType":"geometry","stylers":[{"color":"#f5f1e6"}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#fdfcf8"}]},{"featureType":"road.highway","elementType":"geometry","stylers":[{"color":"#f8c967"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#e9bc62"}]},{"featureType":"road.highway.controlled_access","elementType":"geometry","stylers":[{"color":"#e98d58"}]},{"featureType":"road.highway.controlled_access","elementType":"geometry.stroke","stylers":[{"color":"#db8555"}]},{"featureType":"road.local","elementType":"labels.text.fill","stylers":[{"color":"#806b63"}]},{"featureType":"transit.line","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"transit.line","elementType":"labels.text.fill","stylers":[{"color":"#8f7d77"}]},{"featureType":"transit.line","elementType":"labels.text.stroke","stylers":[{"color":"#ebe3cd"}]},{"featureType":"transit.station","elementType":"geometry","stylers":[{"color":"#dfd2ae"}]},{"featureType":"water","elementType":"geometry.fill","stylers":[{"color":"#b9d3c2"}]},{"featureType":"water","elementType":"labels.text.fill","stylers":[{"color":"#92998d"}]}];function polygonCenter(poly){var lowx,highx,lowy,highy,lats=[],lngs=[],vertices=poly.getPath();for(var i=0;i<vertices.length;i++){lngs.push(vertices.getAt(i).lng());lats.push(vertices.getAt(i).lat())}lats.sort();lngs.sort();lowx=lats[0];highx=lats[vertices.length-1];lowy=lngs[0];highy=lngs[vertices.length-1];center_x=lowx+((highx-lowx)/2);center_y=lowy+((highy-lowy)/2);return(new google.maps.LatLng(center_x,center_y))}function uniqArObject(a,param){return a.filter(function(item,pos,array){return array.map(function(mapItem){return mapItem[param]}).indexOf(item[param])===pos})};var initMap=function(){if(!map){map=new google.maps.Map(document.getElementById('tMap_gMap'),{center:{lat:15.6792206,lng:100.933103},zoom:6,mapTypeId:google.maps.MapTypeId.HYBRID,styles:mapStyle,fullscreenControl:!0,streetViewControl:!1,zoomControl:!1,mapTypeControl:!1});var trafficLayer=new google.maps.TrafficLayer();trafficLayer.setMap(map);loadTruckData();loadSuplier();setInterval(loadTruckData,1000*10)}};function loadSuplier(){$.post(fd,{type:6}).done(function(ddd){var data=JSON.parse(ddd);if(data.ch==1){addMarkerSuplier(data.data)}})};function addMarkerSuplier(data){if(map){for(var i=0,len=data.length;i<len;i++){var row=data[i];if(row.geo.type=='Polygon'){var polygonAr=data[i].geo.coordinates[0].map(function(v){return{lat:parseFloat(v[0]),lng:parseFloat(v[1])}});polygonAr.pop();var polygonMap=new google.maps.Polygon({clickable:!1,paths:polygonAr,strokeColor:'#3498db',fillColor:'#3498db',fillOpacity:.2,strokeWeight:3,clickable:!0,editable:!1});polygonMap.getPosition=function(){return polygonCenter(this)};if(row.polyCenter.type=='Point'){var markerImage=new google.maps.MarkerImage('images/factory.png',null,null,null,null);var point={lat:parseFloat(row.polyCenter.coordinates[0]),lng:parseFloat(row.polyCenter.coordinates[1])};var markerMap=new google.maps.Marker({position:{lat:parseFloat(row.polyCenter.coordinates[0]),lng:parseFloat(row.polyCenter.coordinates[1])},id:row.ID,icon:markerImage});var supName=row.supName,txtCount=supName.length;txtCount+=supName.split(' ').length*.25*-1;txtCount=txtCount*3.5;var markerLabelMap=new MarkerWithLabel({clickable:!1,position:point,labelContent:supName,labelAnchor:new google.maps.Point(txtCount,50),icon:" ",labelStyle:{border:'none',textAlign:'center',fontSize:'12px',width:'auto',color:'#fff',background:'#3498db'}})}markerSuplierAr.push(polygonMap);markerSuplierAr.push(markerMap);markerSuplierAr.push(markerLabelMap);markerClusterSuplier=new MarkerClusterer(map,markerSuplierAr,{imagePath:'codebase/google/images/m',offsetX:1,offsetY:1,minimumClusterSize:4})}}}}function loadTruckData(){$.post(fd,{type:4}).done(function(ddd){var data=JSON.parse(ddd);if(data.ch==1){removeAllMarkerTruck();dataTruck=uniqArObject(data.data,'truckLicense');addMarkerTruck(dataTruck)}})};function addMarkerTruck(data){if(map){var s_pin="M22-48h-44v43h16l6 5 6-5h16z";var car="M17.402,0H5.643C2.526,0,0,3.467,0,6.584v34.804c0,3.116,2.526,5.644,5.643,5.644h11.759c3.116,0,5.644-2.527,5.644-5.644 V6.584C23.044,3.467,20.518,0,17.402,0z M22.057,14.188v11.665l-2.729,0.351v-4.806L22.057,14.188z M20.625,10.773 c-1.016,3.9-2.219,8.51-2.219,8.51H4.638l-2.222-8.51C2.417,10.773,11.3,7.755,20.625,10.773z M3.748,21.713v4.492l-2.73-0.349 V14.502L3.748,21.713z M1.018,37.938V27.579l2.73,0.343v8.196L1.018,37.938z M2.575,40.882l2.218-3.336h13.771l2.219,3.336H2.575z M19.328,35.805v-7.872l2.729-0.355v10.048L19.328,35.805z";for(var i=0,len=data.length;i<len;i++){var row=data[i],latLng={lat:row.t_lat*1,lng:row.t_lng*1};if(row.t_lat*1>0||row.t_lng*1>0){var dataAll=JSON.parse(row.dataAll);var icon={path:car,scale:.4,strokeColor:'black',strokeWeight:.10,fillOpacity:1,fillColor:'YELLOW',offset:'5%',anchor:new google.maps.Point(10,25)};var marker=new google.maps.Marker({map:map,position:latLng,icon:icon,id:row.ID});map_truckAr.push(marker);var markerLabel=new MarkerWithLabel({clickable:!1,map:map,position:latLng,labelContent:row.truckLicense+'<br>'+row.routeTrip,labelAnchor:new google.maps.Point(18,-10),labelClass:"mapLabel",icon:" "});map_truckAr.push(markerLabel);var format=webix.Date.dateToStr("%Y-%m-%d %H:%i");var info_route='1',info_sCode=dataAll[0].supplierCode,info_sName=dataAll[0].supplierName,info_date=format(new Date(dataAll[0].date+' '+dataAll[0].time)),info_bol=dataAll[0].bol;var contentString="<div class='webix_view'>\
<center><h2>* Truck No. "+row.truckLicense+" *</h2></center>\
<table style='border:1px solid #999;'>\
<tr style='background:lightblue;'>\
<td width=250 style=''><b>Route (รหัสเส้นทาง) :</b></td>\
<td width=250><b>"+row.routeTrip+"</b></td>\
</tr>\
<tr>\
<td width=250><b>Supplier Code (รหัสซัพพลายเออร์) :</b></td>\
<td width=250><b>"+info_sCode+"</b></td>\
</tr>\
<tr style='background:lightblue;'>\
<td width=250><b>Supplier Name (ชื่อซัพพลายเออร์) :</b></td>\
<td width=250><b>"+info_sName+"</b></td>\
</tr>\
<tr>\
<td width=250><b>Date (เวลาถึง):</b></td>\
<td width=250><b>"+info_date+"</b></td>\
</tr>\
<tr style='background:lightblue;'>\
<td width=250><b>Driver Name (ชื่อคนขับรถ):</b></td>\
<td width=250><b>"+row.driverName+"</b></td>\
</tr>\
<tr>\
<td width=250><b>Phone (โทรศัพท์):</b></td>\
<td width=250><b>"+row.phone+"</b></td>\
</tr>\
<tr style='background:lightblue;'>\
<td width=250><b>BOL (รหัสติดตาม):</b></td>\
<td width=250><b>"+info_bol+"</b></td>\
</tr>\
</table>\
</div>";var infowindow=new google.maps.InfoWindow({id:row.ID});google.maps.event.addListener(infowindow,'closeclick',function(e){var index=carInfo.indexOf(this.id);if(index!=-1)carInfo.splice(index,1)});google.maps.event.addListener(marker,'click',(function(marker,content,infowindow){return function(){var index=carInfo.indexOf(infowindow.id);infowindow.setContent(content);if(index==-1){carInfo.push(infowindow.id);infowindow.open(map,marker)}else{carInfo.splice(index,1);infowindow.setMap(null);}}})(marker,contentString,infowindow));if(carInfo.indexOf(row.ID)!=-1){infowindow.setContent(contentString);infowindow.open(map,marker)}if(dataAll[0].polyCenter.type=='Point'){var plan=[latLng];plan.push({lat:parseFloat(dataAll[0].polyCenter.coordinates[0]),lng:parseFloat(dataAll[0].polyCenter.coordinates[1])});if(plan[1].lat>1&&plan[1].lng>1&&dataAll[0].insidePolygon==!1){var iconsetngs={path:google.maps.SymbolPath.FORWARD_OPEN_ARROW};var planPath=new google.maps.Polyline({clickable:!1,map:map,path:plan,geodesic:!0,strokeColor:'YELLOW',strokeOpacity:1,strokeWeight:1,icons:[{icon:iconsetngs,repeat:'25px',offset:'100%'}]});planPath.getPosition=function(){return planPath.Bounds().getCenter()};map_truckAr.push(planPath)}}}}}}function refreshTruck(){if(map){if(dataTruck.length>0)addMarkerTruck(dataTruck)}}function hideTruck(){if(map){for(var i=0,len=map_truckAr.length;i<len;i++){map_truckAr[i].setMap(null)}map_truckAr.length=0}}function removeAllMarkerTruck(){if(map){for(var i=0,len=map_truckAr.length;i<len;i++){map_truckAr[i].setMap(null)}map_truckAr.length=0}};return{view:"scrollview",scroll:"native-y",id:"header_tMap",body:{id:"tMap_id",type:"clean",rows:[{id:"tMap_map",template:"<div id='tMap_gMap' style='height:600px;'></div>",autoheight:!0}],on:{onHide:function(){},onShow:function(){},onAddView:function(){setTimeout(function(){initMap()},1000)}}}}};var header_cancelPus=function(){var fd='f1/cancelPus_data.php';function normalState(){$$('cancelPus_section2').hide();$$('cancelPus_form1').show()};function workingState(){$$('cancelPus_form1').hide();$$('cancelPus_section2').show()};return{view:"scrollview",scroll:"native-y",id:"header_cancelPus",body:{id:"cancelPus_id",type:"clean",rows:[{view:"form",paddingY:0,id:"cancelPus_form1",elements:[{cols:[{},{},{view:"text",label:'PUS เลขที่เอกสาร)',labelWidth:150,id:"cancelPus_doc",name:"doc",value:"",width:350},{view:"button",value:"Find (ค้นหา)",id:"cancelPus_find",on:{onItemClick:function(id,e){var dataT1=$$('cancelPus_dataT1');$.post(fd,{obj:$$('cancelPus_form1').getValues(),type:1}).done(function(data){data=JSON.parse(data);if(data.ch==1){workingState();dataT1.clearAll();dataT1.parse(data.data)}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){dataT1.clearAll()}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}},{},{}]}]},{id:"cancelPus_section2",rows:[{cols:[{},{},{view:"button",id:"cancelPus_ok",name:"ok",value:"OK (ตกลง)",type:'form',on:{onItemClick:function(id,e){var dataT1=$$('cancelPus_dataT1'),btn=this;if(dataT1.count()>0){var objArray=dataT1.getSelectedId(!0),len=objArray.length;if(len){var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>ลบข้อมูล</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){btn.disable();$.post(fd,{obj:{form:$$('cancelPus_form1').getValues(),orderID:orderID.join(','),len:len},type:31}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ลบข้อมูลสำเร็จ',callback:function(){}});dataT1.clearAll();dataT1.parse(data.data,"json")}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาเลือกข้อมูลในตาราง',callback:function(){}})}}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}},{view:"button",id:"cancelPus_clear",name:"clear",value:"Clear (ล้างหน้าจอ)",type:'danger',on:{onItemClick:function(id,e){$$('cancelPus_dataT1').clearAll();normalState()}}},{},{}]},{view:"toolbar",paddingY:2,height:35,cols:[{},{view:"label",label:"คลิกเลือกรายการที่ต้องการยกเลิก"},{}]},{view:"datatable",id:"cancelPus_dataT1",multiselect:!0,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"NO_PGM",header:["NO_PGM",{content:"textFilter"}],width:80},{id:"partNo",header:["Part No",{content:"textFilter"}],width:225},{id:"box",header:"Box",width:120},{id:"boxType",header:"Box Type",width:200},{id:"pus",header:"PUS",width:180}]}]}],on:{onHide:function(){},onShow:function(){},onAddView:function(){normalState()}}}}};var header_editPus=function(){var fd='f1/editPus_data.php',objData={},calBox1={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},calBox2={PTB:0,CPB:0,STP:0,PTP:0,PPB:0};function normalState(){_disable_(['editPus_printName','editPus_date','editPus_routeTrip','editPus_supplierCode','editPus_ttvIn','editPus_ttvOut','editPus_truckLicense','editPus_truckType','editPus_driverName','editPus_phone','editPus_remark']);_enable_(['editPus_doc']);$$('editPus_col2').show();$$('editPus_save').hide();$$('editPus_calcel').hide();$$('editPus_showData').hide();$$('editPus_showhide').hide();$$('editPus_form1').show()};function workingState(){_disable_(['editPus_printName','editPus_date','editPus_routeTrip','editPus_supplierCode','editPus_doc']);_enable_(['editPus_ttvIn','editPus_ttvOut','editPus_truckLicense','editPus_truckType','editPus_driverName','editPus_phone','editPus_remark']);$$('editPus_col2').hide();$$('editPus_form1').hide();$$('editPus_save').show();$$('editPus_calcel').show();$$('editPus_showData').show();$$('editPus_showhide').show();$$('editPus_form1').show();$$('editPus_form1').clearValidation();$($$('editPus_doctype').$view).removeClass('webix_invalid')};function init(){var doctype=$$('editPus_doctype'),list=doctype.getPopup().getList();doctype.blockEvent();list.clearAll();doctype.setValue('');webix.ajax().post(fd,{type:1},function(text,data){var data=eval('('+text+')'),htmlNode=$(doctype.$view);list.parse(data);doctype.unblockEvent();if(data.length>0){doctype.enable();if(!htmlNode.hasClass('webix_invalid'))htmlNode.addClass('webix_invalid');webix.message({type:"error",expire:7000,text:'คุณมีงานค้างโปรดตรวจสอบ'})}else{doctype.disable();if(htmlNode.hasClass('webix_invalid'))htmlNode.removeClass('webix_invalid')}})};function rendertable1(){var dataT1=$$('editPus_dataT1');var boxCal={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},row;dataT1.eachRow(function(row){row=dataT1.getItem(row);boxCal[row.boxType]+=parseInt(row.box)});$$('editPus_PTB1').getInputNode().textContent=boxCal.PTB;$$('editPus_CPB1').getInputNode().textContent=boxCal.CPB;$$('editPus_STP1').getInputNode().textContent=boxCal.STP;$$('editPus_PTP1').getInputNode().textContent=boxCal.PTP;$$('editPus_PPB1').getInputNode().textContent=boxCal.PPB};function initParams(){var params={};if(window.location.search){var parts=location.search.substring(1).split('&');for(var i=0;i<parts.length;i++){var nv=parts[i].split('=');if(!nv[0])continue;params[nv[0]]=nv[1]||!0}}if($$('editPus_date').isEnabled()){if('route' in params&&'supplierCode' in params&&'date' in params){$$('editPus_date').setValue(params.date);$$('editPus_routeTrip').setValue(params.route);$$('editPus_supplierCode').setValue(params.supplierCode)}}};return{view:"scrollview",scroll:"native-y",id:"header_editPus",body:{id:"editPus_id",type:"clean",rows:[{view:"form",paddingY:0,id:"editPus_form1",elements:[{cols:[{view:"combo",id:"editPus_printName",name:"printName",label:"Printer Name (ปริ้นเตอร์)",labelPosition:"top",value:"",yCount:"10",options:"php/getPrinter.php",hidden:!0,on:{onChange:function(value){localStorage.setItem("_editPus_printName",value)},onAfterRender:function(value){var v=localStorage.getItem("_editPus_printName")||'NO_PRINT';this.blockEvent();this.setValue(v);this.unblockEvent()}}},{view:"text",label:'PUS เลขที่เอกสาร)',required:!0,labelPosition:"top",id:"editPus_doc",name:"doc",value:""},{view:"counter",label:"Copies",value:"1",id:"editPus_copies",labelPosition:"top",hidden:!0},{view:"combo",yCount:"10",suggest:fd+"?type=1",label:'Document No (งานค้าง)',id:"editPus_doctype",name:"doctype",value:"",labelPosition:"top",on:{onChange:function(value){if(value.length>0)this.disable();else this.enable();$.post(fd,{doc:value,type:12}).done(function(data){data=JSON.parse(data);if(data.ch==1){var form=$$('editPus_form1').getValues(),header=data.header;form.date=header.date;form.routeTrip=header.routeTrip;form.supplierCode=header.supplierCode;form.ttvIn=header.ttvIn||'00:00';form.ttvOut=header.ttvOut||'00:00';form.truckLicense=header.truckLicense;form.truckType=header.truckType;form.driverName=header.driverName;form.phone=header.phone;form.remark=header.remark;form.doc=header.doctype;objData.refID=header.refID;$$('editPus_form1').setValues(form);comboSet('editPus_truckLicense',header.truckLicense);comboSet('editPus_driverName',header.driverName);var dataT1=$$('editPus_dataT2');dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('editPus_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1()}workingState()})}}},{view:"datepicker",align:"left",label:'Date[y-m-d] (วันที่)',labelPosition:"top",value:new Date(),id:"editPus_date",name:"date",stringResult:1,format:webix.Date.dateToStr("%Y-%m-%d")},{view:"text",required:!0,label:'Route (เส้นทาง)',id:"editPus_routeTrip",name:"routeTrip",labelPosition:"top"},{view:"text",required:!0,label:'Supplier Code',id:"editPus_supplierCode",name:"supplierCode",labelPosition:"top"}]},{cols:[{view:"text",required:!0,label:'เวลาออก TTV',id:"editPus_ttvOut",name:"ttvOut",labelPosition:"top",type:'time'},{view:"text",required:!0,label:'เวลากลับ TTV',id:"editPus_ttvIn",name:"ttvIn",labelPosition:"top",type:'time'},{view:"combo",required:!0,label:'Truck License (ทะเบียนรถ)',id:"editPus_truckLicense",name:"truckLicense",labelPosition:"top",suggest:"f3/truckMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/truckMaster_data.php",{obj:{truckLicense:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('editPus_truckType').setValue(data[0])})}}},{view:"text",required:!0,label:'Truck Type (ชนิดรถ)',id:"editPus_truckType",name:"truckType",labelPosition:"top"},{view:"combo",required:!0,label:'Driver Name (ชื่อคนขับรถ)',id:"editPus_driverName",name:"driverName",labelPosition:"top",suggest:"f3/driverMaster_data.php?type=3",on:{onChange:function(value,obj){if(value.toString().trim().toUpperCase().length==0||value.toString().trim().toUpperCase().length==13)return;$.post("f3/driverMaster_data.php",{obj:{driverName:value},type:4}).done(function(data){var data=JSON.parse(data);if(data.length>0)$$('editPus_phone').setValue(data[0])})}}}]},{cols:[{view:"text",required:!0,label:'Phone (เบอร์โทรศัทพ์)',id:"editPus_phone",name:"phone",labelPosition:"top"},{view:"text",required:!1,label:'Remark (หมายเหตุ)',id:"editPus_remark",name:"remark",labelPosition:"top"},{},{},{}]}],rules:{ttvIn:function(v){return v!='00:00'},ttvOut:function(v){return v!='00:00'}},on:{"onSubmit":function(view,e){if(view.config.name=='remark'){}else if(webix.UIManager.getNext(view).config.type=='line'){webix.UIManager.setFocus(webix.UIManager.getNext(webix.UIManager.getNext(view)))}else{webix.UIManager.setFocus(webix.UIManager.getNext(view))}}}},{id:"editPus_col2",cols:[{},{},{view:"button",icon:"users",value:"OK(ตกลง)",id:"editPus_btnOK",on:{onItemClick:function(id,e){if($$('editPus_doc').validate()){var btn=this;btn.disable();$.post(fd,{obj:$$('editPus_form1').getValues(),type:11}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){var form=$$('editPus_form1').getValues(),header=data.header;form.date=header.date;form.routeTrip=header.routeTrip;form.supplierCode=header.supplierCode;form.ttvIn=header.ttvIn||'00:00';form.ttvOut=header.ttvOut||'00:00';form.truckLicense=header.truckLicense;form.truckType=header.truckType;form.driverName=header.driverName;form.phone=header.phone;form.remark=header.remark;form.doctype=header.doctype;form.doc=header.doctype;objData.refID=header.refID;$$('editPus_form1').setValues(form);comboSet('editPus_truckLicense',header.truckLicense);comboSet('editPus_driverName',header.driverName);var dataT1=$$('editPus_dataT2');dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('editPus_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1();workingState();var doctype=$$('editPus_doctype'),list=doctype.getPopup().getList();doctype.blockEvent();list.clearAll();list.parse([header.doctype]);doctype.setValue(list.getFirstId());doctype.unblockEvent()}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}})}else{webix.message({type:"error",expire:7000,text:'กรุณาป้อนข้อมูล'})}}}},{},{}]},{cols:[{},{view:"button",icon:"users",value:"Show/Hide",id:"editPus_showhide",on:{onItemClick:function(id,e){if($$('editPus_form1').isVisible()){$$('editPus_form1').hide()}else $$('editPus_form1').show()}}},{view:"button",value:"Save (บันทึก)",id:"editPus_save",type:"form",click:function(e){var btn=this,dataT1=$$('editPus_dataT1'),dataT2=$$('editPus_dataT2');if(dataT1.count()>0&&dataT2.count()==0&&$$("editPus_form1").validate()){webix.confirm({title:"<b>ข้อความจากระบบ</b>",ok:'ใช่',cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>บันทึกข้อมูล</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(result){if(result){btn.disable();$.post(fd,{obj:$$('editPus_form1').getValues(),type:41}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}});$$('editPus_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง<br>หรือกรอกข้อมูลไม่ครบ',callback:function(){}})}}},{view:"button",type:"danger",value:"Cancel (ยกเลิกเอกสาร)",hidden:0,id:"editPus_calcel",on:{onItemClick:function(id,e){var btn=this;webix.confirm({title:"กรุณายืนยัน",ok:"ใช่",cancel:"ไม่",text:"คุณต้องการ<font color='#ca4635'><br><b>ยกเลิกเอกสาร</b></font><br><font color='#27ae60'><b>ใช่</b></font> หรือ <font color='#3498db'><b>ไม่</b></font>",callback:function(res){if(res){btn.disable();$.post(fd,{obj:$$('editPus_form1').getValues(),type:31}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){webix.message({type:"default",expire:7000,text:data.data});$$('editPus_clear').callEvent("onItemClick",[])}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}}})}}},{},{view:"button",value:"Clear (ล้างหน้าจอ)",hidden:1,id:"editPus_clear",on:{onItemClick:function(id,e){if(!$$('editPus_form1').isVisible())$$('editPus_form1').show();normalState();$$('editPus_form1').clearValidation();init();$$('editPus_date').setValue(new Date());$$('editPus_routeTrip').setValue('');$$('editPus_doc').setValue('');$$('editPus_supplierCode').setValue('');$$('editPus_ttvIn').setValue('');$$('editPus_ttvOut').setValue('');$$('editPus_truckLicense').setValue('');$$('editPus_truckType').setValue('');$$('editPus_driverName').setValue('');$$('editPus_phone').setValue('');$$('editPus_remark').setValue('');$$("editPus_dataT1").clearAll();$$("editPus_dataT2").clearAll();$$('editPus_supplierCode').focus()}}}]},{id:"editPus_showData",cols:[{paddingX:5,rows:[{height:25,cols:[{},{},{view:"label",label:"PTB",align:"center"},{view:"label",label:"CPB",align:"center"},{view:"label",label:"STP",align:"center"},{view:"label",label:"PTP",align:"center"},{view:"label",label:"PPB",align:"center"},{},{}]},{cols:[{},{},{view:"button",id:"editPus_PTB1",label:"0",name:'tooltip',value:'กล่องพลาสติก'},{view:"button",id:"editPus_CPB1",label:"0",name:'tooltip',value:'กล่องลูกฟูก'},{view:"button",id:"editPus_STP1",label:"0",name:'tooltip',value:'แร็ค'},{view:"button",id:"editPus_PTP1",label:"0",name:'tooltip',value:'พาเลทพลาสติก'},{view:"button",id:"editPus_PPB1",label:"0",name:'tooltip',value:'กล่องกระดาษ'},{},{view:"button",type:"danger",type:"iconButtonTop",icon:"angle-double-right",on:{"onAfterRender":function(e){this.$view.getElementsByTagName("button")[0].className=this.$view.getElementsByTagName("button")[0].className.replace('webixtype_base','webixtype_danger')},"onItemClick":function(id,e){var dataT1=$$('editPus_dataT1'),btn=this;if(dataT1.count()>0){dataT1.selectRange(dataT1.getFirstId(),dataT1.getLastId());var objArray=dataT1.getSelectedId(!0),len=objArray.length;var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}btn.disable();$.post(fd,{obj:{form:$$('editPus_form1').getValues(),orderID:orderID.join(',')},type:14}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.selected);dataT1=$$('editPus_dataT2');dataT1.clearAll();dataT1.parse(data.order);rendertable1()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}}]},{paddingY:0,height:35,view:"toolbar",cols:[{view:"label",label:"Truck Simulate",align:"center"}]},{view:"datatable",id:"editPus_dataT1",multiselect:!0,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,hover:"myhover",navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"NO_PGM",header:"NO_PGM",width:80},{id:"partNo",header:"Part No",width:225},{id:"box",header:"Box",width:120,footer:{content:"summColumn",colspan:1}},{id:"boxType",header:"Box Type",width:200}],on:{}}]},{paddingX:5,rows:[{height:25,cols:[{},{},{view:"label",label:"PTB",align:"center"},{view:"label",label:"CPB",align:"center"},{view:"label",label:"STP",align:"center"},{view:"label",label:"PTP",align:"center"},{view:"label",label:"PPB",align:"center"},{},{}]},{cols:[{view:"button",type:"iconButtonTop",icon:"angle-double-left",on:{"onAfterRender":function(e){this.$view.getElementsByTagName("button")[0].className=this.$view.getElementsByTagName("button")[0].className.replace('webixtype_base','webixtype_form')},"onItemClick":function(id,e){var dataT1=$$('editPus_dataT2'),btn=this;if(dataT1.count()>0){dataT1.selectRange(dataT1.getFirstId(),dataT1.getLastId());var objArray=dataT1.getSelectedId(!0),len=objArray.length;var orderID=[],obj={},row;for(var i=-1;++i<len;){orderID[orderID.length]=parseInt(dataT1.getItem(objArray[i].row).ID)}btn.disable();$.post(fd,{obj:{form:$$('editPus_form1').getValues(),orderID:orderID.join(',')},type:13}).done(function(data){btn.enable();var data=JSON.parse(data);if(data.ch==1){dataT1.clearAll();dataT1.parse(data.order);dataT1=$$('editPus_dataT1');dataT1.clearAll();dataT1.parse(data.selected);rendertable1()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else{webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'ไม่พบข้อมูลในตาราง',callback:function(){}})}}}},{},{view:"button",id:"editPus_PTB2",label:"0",name:'tooltip',value:'กล่องพลาสติก'},{view:"button",id:"editPus_CPB2",label:"0",name:'tooltip',value:'กล่องลูกฟูก'},{view:"button",id:"editPus_STP2",label:"0",name:'tooltip',value:'แร็ค'},{view:"button",id:"editPus_PTP2",label:"0",name:'tooltip',value:'พาเลทพลาสติก'},{view:"button",id:"editPus_PPB2",label:"0",name:'tooltip',value:'กล่องกระดาษ'},{},{}]},{paddingY:0,height:35,view:"toolbar",cols:[{view:"label",label:"Order",align:"center"}]},{view:"datatable",id:"editPus_dataT2",multiselect:!0,autoheight:!1,datatype:"json",datathrottle:1000,select:"row",footer:!1,hover:"myhover",navigation:!0,resizeColumn:!0,fixedRowHeight:!1,scrollAlignY:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"NO_PGM",header:"NO_PGM",width:80},{id:"partNo",header:"Part No",width:225},{id:"box",header:"Box",width:120,footer:{content:"summColumn",colspan:1}},{id:"boxType",header:"Box Type",width:200}],on:{"onSelectChange":function(){var dataAr=this.getSelectedId(!0),len=dataAr.length;var boxCal={PTB:0,CPB:0,STP:0,PTP:0,PPB:0},row;for(var i=0;i<len;i++){row=this.getItem(dataAr[i].row);boxCal[row.boxType]+=parseInt(row.box)}$$('editPus_PTB2').getInputNode().textContent=boxCal.PTB;$$('editPus_CPB2').getInputNode().textContent=boxCal.CPB;$$('editPus_STP2').getInputNode().textContent=boxCal.STP;$$('editPus_PTP2').getInputNode().textContent=boxCal.PTP;$$('editPus_PPB2').getInputNode().textContent=boxCal.PPB}}}]}]}],on:{onHide:function(){},onShow:function(){initParams()},onAddView:function(){webix.ui({view:"tooltip",template:"#tooltip#"});init();normalState();initParams()}}}}};var header_transaction=function(){var fd='f2/transaction_data.php';return{view:"scrollview",scroll:"native-y",id:"header_transaction",body:{id:"transaction_id",type:"clean",rows:[{view:"form",paddingY:0,id:"transaction_form1",elements:[{view:"fieldset",label:"Search (ป้อนข้อมูลการค้นหา)",body:{rows:[{cols:[{view:"datepicker",name:"date1",labelPosition:"top",label:"Start Date (วันเริ่มต้น)",type:"date",id:"transaction_date1",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1},{view:"datepicker",name:"date2",labelPosition:"top",label:"End Date (วันสิ้นสุด)",type:"date",id:"transaction_date2",format:webix.Date.dateToStr("%Y-%m-%d"),value:new Date(),stringResult:1},{view:"text",labelPosition:"top",label:'Bol (รหัสติดตาม)',id:"transaction_part",name:"bol",value:""},{view:"text",labelPosition:"top",label:'Pus No (เลขที่เอกสาร)',id:"transaction_pus",name:"pus",value:""},{view:"text",labelPosition:"top",label:'Route (รหัสเส้นทาง)',id:"transaction_route",name:"route",value:""}]},{view:"toolbar",paddingY:2,cols:[{view:"button",value:"Find (ค้นหา)",width:130,id:"transaction_find",on:{onItemClick:function(id,e){if($$('transaction_form1').validate()){var btn=this;var pager=$$("transaction_pagerA"),obj=$$('transaction_form1').getValues(),show=pager.config.size,page=pager.config.page,dataT1=$$('transaction_dataT1');if(id){pager.blockEvent();pager.config.count=0;pager.config.page=0;pager.config.clickPage='';pager.refresh();pager.render();pager.unblockEvent()}obj.skip=page*show;obj.limit=show;obj.page=page;obj.click=pager.config.clickPage||'';obj.f=0;obj.l=0;obj.count=pager.config.count||0;obj.dataType='json';if(dataT1.count()>0){obj.f=dataT1.getItem(dataT1.getFirstId()).data1;obj.l=dataT1.getItem(dataT1.getLastId()).data1}btn.disable();pager.disable();$.post(fd,{obj:obj,type:1}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){dataT1.clearAll();dataT1.parse(data.data);pager.blockEvent();pager.config.count=data.count;pager.refresh();pager.render();pager.unblockEvent();pager.enable()}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}},{},{view:"button",align:"right",label:"Export Data",type:"icon",icon:"file-excel-o",width:130,id:"transaction_ok",on:{onItemClick:function(id,e){if($$('transaction_form1').validate()){var btn=this;var pager=$$("transaction_pagerA"),obj=$$('transaction_form1').getValues(),show=pager.config.size,page=pager.config.page,dataT1=$$('transaction_dataT1');obj.dataType='array';obj.skip=page*show;obj.limit=show;obj.count=0;btn.disable();pager.disable();$.post(fd,{obj:obj,type:1}).done(function(data){btn.enable();data=eval('('+data+')');if(data.ch==1){var worker=new Worker('js/workerToExcel.js?v=1');worker.addEventListener('message',function(e){saveAs(e.data,'TTV'+new Date().getTime()+".xlsx");btn.enable();webix.message({expire:7000,text:"Export สำเร็จ"})},!1);worker.postMessage({cmd:'start',msg:data.data})}else if(data.ch==2){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==9){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){}})}else if(data.ch==10){webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:data.data,callback:function(){window.open("login.php","_self")}})}})}else webix.alert({title:"<b>ข้อความจากระบบ</b>",ok:'ตกลง',text:'กรุณาป้อนข้อมูล<font color="#ce5545"><b>ในช่องสีแดง</b></font>ให้ครบ',callback:function(){}})}}}]},{rows:[{view:"datatable",id:"transaction_dataT1",autoheight:!0,datatype:"json",resizeColumn:!0,datathrottle:1000,hover:"myhover",navigation:!0,columns:[{id:"NO",header:"No",css:"rank",width:50},{id:"bol",header:"Bol",width:130,editor:"text"},{id:"routeTrip",header:"Route",width:130,editor:"text"},{id:"ld_supplierCode",header:"Supplier Code",width:140,editor:"text"},{id:"ld_supplierName",header:"Supplier Name",width:200,editor:"text"},{id:"ldDateTime",header:"DateTime",width:150,editor:"text"},{id:"ldAcDateTime",header:"Ac DateTime",width:150,editor:"text"},{id:"pusPlus",header:"Pus",width:150,editor:"text"},{id:"tripTTV",header:"Trip TTV",width:100,editor:"text"},{id:"truckLicense",header:"Truck No",width:120,editor:"text"},{id:"truckType",header:"Truck Type",width:80,editor:"text"},{id:"driverName",header:"Driver Name",width:200,editor:"text"},{id:"phone",header:"Phone",width:120,editor:"text"},{id:"remark",header:"Remark",width:200,editor:"text"},{id:"cDateTime",header:"Create Date",width:120,editor:"text"},{id:"createBy",header:"Create By",width:200,editor:"text"},{id:"upDateTime",header:"Update Date",width:120,editor:"text"},{id:"updateBy",header:"Update By",width:200,editor:"text"}]},{type:"wide",cols:[{view:"pager",id:"transaction_pagerA",size:10,master:!1,group:5,template:function(data,common){var start=data.page*data.size,end=start+data.size;if(data.count==0)start=0;else start+=1;if(end>=data.count)end=data.count;var html="<b>showing "+(start)+" - "+end+" total "+data.count+" </b>";return common.first()+common.prev()+" "+html+" "+common.next()+common.last()},on:{onAfterRender:function(){var enterID=$$('transaction_find');$$(enterID).callEvent("onItemClick",null)},onItemClick:function(id,e,node){this.config.clickPage=id}}}]}]}]}}],rules:{date1:webix.rules.isNotEmpty,date2:webix.rules.isNotEmpty}}],on:{onHide:function(){},onShow:function(){},onAddView:function(){}}}}};</script><script src="main.js?v=2" charset="utf-8"></script><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC9ItnaPb2x897MTFxXygqJdT6QPVTW6Hc&libraries=places,drawing"></script><script src="codebase/google/v3_epoly.min.js"></script><script src="codebase/google/markerwithlabel.min.js"></script></body></html>
         